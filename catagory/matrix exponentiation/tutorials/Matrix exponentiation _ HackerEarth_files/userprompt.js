function get_prompts(a){$.ajax({url:"/AJAX/get-prompt/",type:"POST",data:{obj_str:a},success:function(a){for(var b in a)$("#"+b).html(a[b])}})}function fetch_initial_user_prompts(){obj_str=$.trim($("#user-prompt-json").html()),obj_str!="{}"&&obj_str!=""&&get_prompts(obj_str)}function constructFormJson(a){var b=new Object,a=a.serializeArray();return $.each(a,function(){b[this.name]?(b[this.name].push||(b[this.name]=[b[this.name]]),b[this.name].push(this.value||"")):b[this.name]=this.value||""}),JSON.stringify(b)}var NEXT="zl23kjs2s";$(document).ready(function(){fetch_initial_user_prompts(),$(".save-prompt").live("click",function(){$this=$(this);var a=$this.attr("disabled");if(a==="disabled")return!1;json_str=$("#user-prompt-json").html(),$(".hide-on-submit").hide(0,function(){$(".form-loader").show()}),objs=JSON.parse(json_str);var b=$this.data("prompt-pk"),c=objs[b],d=new Object;d[b]=c;var e=JSON.stringify(d);e=$.trim(e);var f=$this.parents("form");f=constructFormJson(f),$(".save-prompt").attr("disabled","disabled"),$(".save-prompt-and-next").attr("disabled","disabled"),e!=""&&$.ajax({url:"/AJAX/save-prompt/",type:"POST",data:{obj_str:e,form_data:f},success:function(a){if(a.status!=="ERROR"&&a.next!==null)for(var b in a)$("#"+b).html(a[b]);else prompt_div=$this.parents(".prompt-container"),$(prompt_div).fadeOut(500)}})}),$(".skip-prompt").live("click",function(){json_str=$("#user-prompt-json").html(),$(".hide-on-submit").hide(),$(".form-loader").show(),objs=JSON.parse(json_str);var a=$(this).data("prompt-pk"),b=objs[a],c=b[NEXT];if(c){var d=objs[c],e=new Object;e[c]=d,obj_str=JSON.stringify(e),get_prompts(obj_str)}else $(this).parents(".prompt-container").fadeOut(500)}),$(".cross-prompt").live("click",function(){$this=$(this),json_str=$("#user-prompt-json").html(),objs=JSON.parse(json_str);var a=$(this).data("prompt-pk"),b=$(this).data("cross-all"),c=objs[a];if(NEXT in c){next_prompt_pk=c[NEXT];var d=objs[next_prompt_pk];next_obj_dict=new Object,next_obj_dict[next_prompt_pk]=d}else next_obj_dict=new Object;var e=new Object;e[a]=next_obj_dict,obj_str=JSON.stringify(e),$.ajax({url:"/AJAX/cross-prompt/",type:"POST",data:{obj_str:obj_str,cross_all:b},success:function(a){if("status"in a&&a.status==="ERROR")prompt_div=$this.parents(".prompt-container"),$(prompt_div).fadeOut(500);else for(var b in a)$("#"+b).html(a[b])}})}),$(".save-prompt-and-next").live("click",function(){$this=$(this);var a=$this.attr("disabled");if(a==="disabled")return!1;$(".hide-on-submit").hide(0,function(){$(".form-loader").show()});var b=$this.attr("execute-before-submit");if(b){funcs=b.split(" ");for(var c=0;c<funcs.length;c++){var d=funcs[c];window[d]($this)}}json_str=$("#user-prompt-json").html(),objs=JSON.parse(json_str);var e=$this.data("prompt-pk"),f=objs[e],g=new Object;g[e]=f;var h=JSON.stringify(g);h=$.trim(h);var i=$this.parents("form");i=constructFormJson(i),next_obj=new Object;if(NEXT in f){var j=f[NEXT];next_obj[j]=objs[j]}next_obj_str=$.trim(JSON.stringify(next_obj)),$(".save-prompt").attr("disabled","disabled"),$(".save-prompt-and-next").attr("disabled","disabled"),h!=""&&$.ajax({url:"/AJAX/save-prompt/",type:"POST",data:{obj_str:h,next_obj_str:next_obj_str,form_data:i},success:function(a){if("status"in a&&a.status==="ERROR")prompt_div=$this.parents(".prompt-container"),$(prompt_div).fadeOut(500);else for(var b in a)$("#"+b).html(a[b])}})})});