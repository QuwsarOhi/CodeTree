<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<!-- saved from url=(0067)https://www.hackerearth.com/practice/notes/matrix-exponentiation-1/ -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta name="theme-color" content="#323754">
        
        <meta name="description" content=" 
## Introduction ## Matrix is a popular math object. It is basically a two-dimensional table of numbers. In this article we’ll look at integer matrices, i.e. tables with integers. This ...
 HackerEarth is a network of top developers across the world. Developers participate in online coding challenges and hackathons, solve problems and discover the best jobs.">
        <link rel="canonical" href="https://www.hackerearth.com/practice/notes/matrix-exponentiation-1/">
        <meta name="msvalidate.01" content="1BF418E510B5A17A2D71685C571BF4EB">

        <!-- Errorception tracking snippet -->
        <script type="application/javascript" async="" defer="" src="./Matrix exponentiation _ HackerEarth_files/track.js"></script><script src="./Matrix exponentiation _ HackerEarth_files/55ba39a81acd32ac7d0002d4.js" async=""></script><script src="./Matrix exponentiation _ HackerEarth_files/cb=gapi.loaded_1" async=""></script><script src="./Matrix exponentiation _ HackerEarth_files/cb=gapi.loaded_0" async=""></script><script type="text/javascript" async="" src="./Matrix exponentiation _ HackerEarth_files/recaptcha__en.js"></script><script type="text/javascript" async="" src="./Matrix exponentiation _ HackerEarth_files/5F90ycbP4JOg1fOUoELScA.js"></script><script type="text/javascript" async="" src="./Matrix exponentiation _ HackerEarth_files/plusone.js" gapi_processed="true"></script><script id="twitter-wjs" src="./Matrix exponentiation _ HackerEarth_files/widgets.js"></script><script id="facebook-jssdk" src="./Matrix exponentiation _ HackerEarth_files/all.js"></script><script type="text/javascript" async="" src="./Matrix exponentiation _ HackerEarth_files/mixpanel-2.2.min.js"></script><script src="./Matrix exponentiation _ HackerEarth_files/identity.js" async=""></script><script src="./Matrix exponentiation _ HackerEarth_files/802574803157043" async=""></script><script async="" src="./Matrix exponentiation _ HackerEarth_files/fbevents.js"></script><script type="text/javascript" async="" src="./Matrix exponentiation _ HackerEarth_files/conversion_async.js"></script><script async="" src="./Matrix exponentiation _ HackerEarth_files/gtm.js"></script><script async="" src="./Matrix exponentiation _ HackerEarth_files/analytics.js"></script><script>
            (function(_,e,rr,s){_errs=[s];var c=_.onerror;_.onerror=function(){var a=arguments;_errs.push(a);
            c&&c.apply(this,a)};var b=function(){var c=e.createElement(rr),b=e.getElementsByTagName(rr)[0];
            c.src="//beacon.errorception.com/"+s+".js";c.async=!0;b.parentNode.insertBefore(c,b)};
            _.addEventListener?_.addEventListener("load",b,!1):_.attachEvent("onload",b)})
            (window,document,"script","55ba39a81acd32ac7d0002d4");
        </script>

        
<meta name="google-site-verification" content="ozqyeStBcz4eehbY9Ohb_IUQcA4y8BKzzDCT-H1QPPc">


        
        
        <!-- google analytics start -->
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-34729975-1', 'auto');
            ga('require', 'displayfeatures');
            
            ga('send', 'pageview');
        </script>
        <!-- google analytics end -->
        
        

        
        
        <!-- Google Tag Manager -->
        <script>
            (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
            new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
            j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
            'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
            })(window,document,'script','dataLayer','GTM-PBHB3B9');
        </script>
        <!-- End Google Tag Manager -->
        
        
        
        <title>   Matrix exponentiation  | HackerEarth  </title>

        
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<!-- Facebook tags -->
<meta property="fb:app_id" content="190817380995032">
<meta property="og:title" content="Matrix exponentiation - Mike Koltsov">
<meta property="og:image" content="https://he-s3.s3.amazonaws.com/media/avatars/misha/resized/200/0e47b5cimg_20140706_164324.jpg">
<meta property="og:description" content="## Introduction ## Matrix is a popular math object. It is basically a two-dimensional table of numbers. In this article we’ll look at integer matrices, i.e. tables with integers. This is how matrices are usually pictured: ![nxm matrix][1] **A** is ...">
<meta property="og:url" content="https://www.hackerearth.com/practice/notes/matrix-exponentiation-1/">
<meta property="og:site_name" content="HackerEarth">
<meta property="og:type" content="website">
<!-- end Facbook tags -->

<!-- Twitter tags -->
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@HackerEarth">
<meta name="twitter:url" content="https://www.hackerearth.com/practice/notes/matrix-exponentiation-1/">
<meta name="twitter:title" content="Matrix exponentiation">
<!-- end Twitter tags -->

        
        <link rel="shortcut icon" href="./Matrix exponentiation _ HackerEarth_files/HE_identity.png" type="image/x-icon">
        

        <link rel="stylesheet" href="./Matrix exponentiation _ HackerEarth_files/base_common_combined.css">
        <link rel="stylesheet" href="./Matrix exponentiation _ HackerEarth_files/tipTip.css">
        <link rel="stylesheet" href="./Matrix exponentiation _ HackerEarth_files/offline-theme-slide.css">
        <link rel="stylesheet" href="./Matrix exponentiation _ HackerEarth_files/font-awesome.min.css">
        <link rel="stylesheet" href="./Matrix exponentiation _ HackerEarth_files/opensans.css" type="text/css">

        



        
<link rel="stylesheet" type="text/css" href="./Matrix exponentiation _ HackerEarth_files/polls.css">
<link rel="stylesheet" type="text/css" href="./Matrix exponentiation _ HackerEarth_files/pagedown.css">
<link rel="stylesheet" type="text/css" href="./Matrix exponentiation _ HackerEarth_files/notes.css">
<link rel="stylesheet" type="text/css" href="./Matrix exponentiation _ HackerEarth_files/nice_threadedcomments.css">
<link href="./Matrix exponentiation _ HackerEarth_files/prettify.css" type="text/css" rel="stylesheet">


        <!-- Make the static variable available for all js files -->
        <script>
            var STATIC_URL = "https://hackerearth.global.ssl.fastly.net/static/";
        </script>

        <!-- Store CSRF_COOKIE -->
        <script>
            var CSRF_COOKIE_USED = "True";
            var CSRF_COOKIE = "zPtTGTgNYBeJSZauzzvzzPSYGWVYs4eYfdPHt1cAhsfG0DhhnvyobVDhwPd5J3M3";
        </script>

        

    <script type="text/javascript" charset="utf-8" async="" src="./Matrix exponentiation _ HackerEarth_files/button.c794c32aa66923d37742ceab3914757c.js"></script><style type="text/css" media="screen">.uv-icon{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box;display:inline-block;cursor:pointer;position:relative;-moz-transition:all 300ms;-o-transition:all 300ms;-webkit-transition:all 300ms;transition:all 300ms;width:39px;height:39px;position:fixed;z-index:100002;opacity:0.8;-moz-transition:opacity 100ms;-o-transition:opacity 100ms;-webkit-transition:opacity 100ms;transition:opacity 100ms}.uv-icon.uv-bottom-right{bottom:10px;right:12px}.uv-icon.uv-top-right{top:10px;right:12px}.uv-icon.uv-bottom-left{bottom:10px;left:12px}.uv-icon.uv-top-left{top:10px;left:12px}.uv-icon.uv-is-selected{opacity:1}.uv-icon svg{width:39px;height:39px}.uv-popover{font-family:sans-serif;font-weight:100;font-size:13px;color:black;position:fixed;z-index:100001}.uv-popover-content{-moz-border-radius:5px;-webkit-border-radius:5px;border-radius:5px;background:white;position:relative;width:325px;height:325px;-moz-transition:background 200ms;-o-transition:background 200ms;-webkit-transition:background 200ms;transition:background 200ms}.uv-bottom .uv-popover-content{-moz-box-shadow:rgba(0,0,0,0.3) 0 -10px 60px,rgba(0,0,0,0.1) 0 0 20px;-webkit-box-shadow:rgba(0,0,0,0.3) 0 -10px 60px,rgba(0,0,0,0.1) 0 0 20px;box-shadow:rgba(0,0,0,0.3) 0 -10px 60px,rgba(0,0,0,0.1) 0 0 20px}.uv-top .uv-popover-content{-moz-box-shadow:rgba(0,0,0,0.3) 0 10px 60px,rgba(0,0,0,0.1) 0 0 20px;-webkit-box-shadow:rgba(0,0,0,0.3) 0 10px 60px,rgba(0,0,0,0.1) 0 0 20px;box-shadow:rgba(0,0,0,0.3) 0 10px 60px,rgba(0,0,0,0.1) 0 0 20px}.uv-left .uv-popover-content{-moz-box-shadow:rgba(0,0,0,0.3) 10px 0 60px,rgba(0,0,0,0.1) 0 0 20px;-webkit-box-shadow:rgba(0,0,0,0.3) 10px 0 60px,rgba(0,0,0,0.1) 0 0 20px;box-shadow:rgba(0,0,0,0.3) 10px 0 60px,rgba(0,0,0,0.1) 0 0 20px}.uv-right .uv-popover-content{-moz-box-shadow:rgba(0,0,0,0.3) -10px 0 60px,rgba(0,0,0,0.1) 0 0 20px;-webkit-box-shadow:rgba(0,0,0,0.3) -10px 0 60px,rgba(0,0,0,0.1) 0 0 20px;box-shadow:rgba(0,0,0,0.3) -10px 0 60px,rgba(0,0,0,0.1) 0 0 20px}.uv-ie8 .uv-popover-content{position:relative}.uv-ie8 .uv-popover-content .uv-popover-content-shadow{display:block;background:black;content:'';position:absolute;left:-15px;top:-15px;width:100%;height:100%;filter:progid:DXImageTransform.Microsoft.Blur(PixelRadius=15,MakeShadow=true,ShadowOpacity=0.30);z-index:-1}.uv-popover-tail{border:9px solid transparent;width:0;z-index:10;position:absolute;-moz-transition:border-top-color 200ms;-o-transition:border-top-color 200ms;-webkit-transition:border-top-color 200ms;transition:border-top-color 200ms}.uv-top .uv-popover-tail{bottom:-20px;border-top:11px solid white}.uv-bottom .uv-popover-tail{top:-20px;border-bottom:11px solid white}.uv-left .uv-popover-tail{right:-20px;border-left:11px solid white}.uv-right .uv-popover-tail{left:-20px;border-right:11px solid white}.uv-popover-loading{background:white;-moz-border-radius:5px;-webkit-border-radius:5px;border-radius:5px;position:absolute;width:100%;height:100%;left:0;top:0}.uv-popover-loading-text{position:absolute;top:50%;margin-top:-0.5em;width:100%;text-align:center}.uv-popover-iframe-container{height:100%}.uv-popover-iframe{-moz-border-radius:5px;-webkit-border-radius:5px;border-radius:5px;overflow:hidden}.uv-is-hidden{display:none}.uv-is-invisible{display:block !important;visibility:hidden !important}.uv-is-transitioning{display:block !important}.uv-no-transition{-moz-transition:none !important;-webkit-transition:none !important;-o-transition:color 0 ease-in !important;transition:none !important}.uv-fade{opacity:1;-moz-transition:opacity 200ms ease-out;-o-transition:opacity 200ms ease-out;-webkit-transition:opacity 200ms ease-out;transition:opacity 200ms ease-out}.uv-fade.uv-is-hidden{opacity:0}.uv-scale-top,.uv-scale-top-left,.uv-scale-top-right,.uv-scale-bottom,.uv-scale-bottom-left,.uv-scale-bottom-right,.uv-scale-right,.uv-scale-right-top,.uv-scale-right-bottom,.uv-scale-left,.uv-scale-left-top,.uv-scale-left-bottom,.uv-slide-top,.uv-slide-bottom,.uv-slide-left,.uv-slide-right{opacity:1;-moz-transition:all 80ms ease-out;-o-transition:all 80ms ease-out;-webkit-transition:all 80ms ease-out;transition:all 80ms ease-out}.uv-scale-top.uv-is-hidden{opacity:0;-moz-transform:scale(0.8) translateY(-15%);-ms-transform:scale(0.8) translateY(-15%);-webkit-transform:scale(0.8) translateY(-15%);transform:scale(0.8) translateY(-15%)}.uv-scale-top-left.uv-is-hidden{opacity:0;-moz-transform:scale(0.8) translateY(-15%) translateX(-10%);-ms-transform:scale(0.8) translateY(-15%) translateX(-10%);-webkit-transform:scale(0.8) translateY(-15%) translateX(-10%);transform:scale(0.8) translateY(-15%) translateX(-10%)}.uv-scale-top-right.uv-is-hidden{opacity:0;-moz-transform:scale(0.8) translateY(-15%) translateX(10%);-ms-transform:scale(0.8) translateY(-15%) translateX(10%);-webkit-transform:scale(0.8) translateY(-15%) translateX(10%);transform:scale(0.8) translateY(-15%) translateX(10%)}.uv-scale-bottom.uv-is-hidden{opacity:0;-moz-transform:scale(0.8) translateY(15%);-ms-transform:scale(0.8) translateY(15%);-webkit-transform:scale(0.8) translateY(15%);transform:scale(0.8) translateY(15%)}.uv-scale-bottom-left.uv-is-hidden{opacity:0;-moz-transform:scale(0.8) translateY(15%) translateX(-10%);-ms-transform:scale(0.8) translateY(15%) translateX(-10%);-webkit-transform:scale(0.8) translateY(15%) translateX(-10%);transform:scale(0.8) translateY(15%) translateX(-10%)}.uv-scale-bottom-right.uv-is-hidden{opacity:0;-moz-transform:scale(0.8) translateY(15%) translateX(10%);-ms-transform:scale(0.8) translateY(15%) translateX(10%);-webkit-transform:scale(0.8) translateY(15%) translateX(10%);transform:scale(0.8) translateY(15%) translateX(10%)}.uv-scale-right.uv-is-hidden{opacity:0;-moz-transform:scale(0.8) translateX(15%);-ms-transform:scale(0.8) translateX(15%);-webkit-transform:scale(0.8) translateX(15%);transform:scale(0.8) translateX(15%)}.uv-scale-right-top.uv-is-hidden{opacity:0;-moz-transform:scale(0.8) translateX(15%) translateY(-10%);-ms-transform:scale(0.8) translateX(15%) translateY(-10%);-webkit-transform:scale(0.8) translateX(15%) translateY(-10%);transform:scale(0.8) translateX(15%) translateY(-10%)}.uv-scale-right-bottom.uv-is-hidden{opacity:0;-moz-transform:scale(0.8) translateX(15%) translateY(10%);-ms-transform:scale(0.8) translateX(15%) translateY(10%);-webkit-transform:scale(0.8) translateX(15%) translateY(10%);transform:scale(0.8) translateX(15%) translateY(10%)}.uv-scale-left.uv-is-hidden{opacity:0;-moz-transform:scale(0.8) translateX(-15%);-ms-transform:scale(0.8) translateX(-15%);-webkit-transform:scale(0.8) translateX(-15%);transform:scale(0.8) translateX(-15%)}.uv-scale-left-top.uv-is-hidden{opacity:0;-moz-transform:scale(0.8) translateX(-15%) translateY(-10%);-ms-transform:scale(0.8) translateX(-15%) translateY(-10%);-webkit-transform:scale(0.8) translateX(-15%) translateY(-10%);transform:scale(0.8) translateX(-15%) translateY(-10%)}.uv-scale-left-bottom.uv-is-hidden{opacity:0;-moz-transform:scale(0.8) translateX(-15%) translateY(10%);-ms-transform:scale(0.8) translateX(-15%) translateY(10%);-webkit-transform:scale(0.8) translateX(-15%) translateY(10%);transform:scale(0.8) translateX(-15%) translateY(10%)}.uv-slide-top.uv-is-hidden{-moz-transform:translateY(-100%);-ms-transform:translateY(-100%);-webkit-transform:translateY(-100%);transform:translateY(-100%)}.uv-slide-bottom.uv-is-hidden{-moz-transform:translateY(100%);-ms-transform:translateY(100%);-webkit-transform:translateY(100%);transform:translateY(100%)}.uv-slide-left.uv-is-hidden{-moz-transform:translateX(-100%);-ms-transform:translateX(-100%);-webkit-transform:translateX(-100%);transform:translateX(-100%)}.uv-slide-right.uv-is-hidden{-moz-transform:translateX(100%);-ms-transform:translateX(100%);-webkit-transform:translateX(100%);transform:translateX(100%)}
</style><style type="text/css" media="screen">.uv-icon:hover{opacity:1}</style><style type="text/css" media="print">#uvTab,.uv-tray,.uv-icon,.uv-popover,.uv-bubble{display:none!important}</style><style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 5px 0px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 5px; -webkit-border-radius: 5px; -moz-border-radius: 5px; -khtml-border-radius: 5px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 1px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: .7em}
.MathJax_MenuRadioCheck.RTL {right: .7em; left: auto}
.MathJax_MenuLabel {padding: 1px 2em 3px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #DDDDDD; margin: 4px 3px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: #606872; color: white}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><style type="text/css">.fb_hidden{position:absolute;top:-10000px;z-index:10001}.fb_reposition{overflow:hidden;position:relative}.fb_invisible{display:none}.fb_reset{background:none;border:0;border-spacing:0;color:#000;cursor:auto;direction:ltr;font-family:"lucida grande", tahoma, verdana, arial, sans-serif;font-size:11px;font-style:normal;font-variant:normal;font-weight:normal;letter-spacing:normal;line-height:1;margin:0;overflow:visible;padding:0;text-align:left;text-decoration:none;text-indent:0;text-shadow:none;text-transform:none;visibility:visible;white-space:normal;word-spacing:normal}.fb_reset>div{overflow:hidden}.fb_link img{border:none}@keyframes fb_transform{from{opacity:0;transform:scale(.95)}to{opacity:1;transform:scale(1)}}.fb_animate{animation:fb_transform .3s forwards}
.fb_dialog{background:rgba(82, 82, 82, .7);position:absolute;top:-10000px;z-index:10001}.fb_reset .fb_dialog_legacy{overflow:visible}.fb_dialog_advanced{padding:10px;-moz-border-radius:8px;-webkit-border-radius:8px;border-radius:8px}.fb_dialog_content{background:#fff;color:#333}.fb_dialog_close_icon{background:url(http://static.xx.fbcdn.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 0 transparent;cursor:pointer;display:block;height:15px;position:absolute;right:18px;top:17px;width:15px}.fb_dialog_mobile .fb_dialog_close_icon{top:5px;left:5px;right:auto}.fb_dialog_padding{background-color:transparent;position:absolute;width:1px;z-index:-1}.fb_dialog_close_icon:hover{background:url(http://static.xx.fbcdn.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -15px transparent}.fb_dialog_close_icon:active{background:url(http://static.xx.fbcdn.net/rsrc.php/v3/yq/r/IE9JII6Z1Ys.png) no-repeat scroll 0 -30px transparent}.fb_dialog_loader{background-color:#f6f7f9;border:1px solid #606060;font-size:24px;padding:20px}.fb_dialog_top_left,.fb_dialog_top_right,.fb_dialog_bottom_left,.fb_dialog_bottom_right{height:10px;width:10px;overflow:hidden;position:absolute}.fb_dialog_top_left{background:url(http://static.xx.fbcdn.net/rsrc.php/v3/ye/r/8YeTNIlTZjm.png) no-repeat 0 0;left:-10px;top:-10px}.fb_dialog_top_right{background:url(http://static.xx.fbcdn.net/rsrc.php/v3/ye/r/8YeTNIlTZjm.png) no-repeat 0 -10px;right:-10px;top:-10px}.fb_dialog_bottom_left{background:url(http://static.xx.fbcdn.net/rsrc.php/v3/ye/r/8YeTNIlTZjm.png) no-repeat 0 -20px;bottom:-10px;left:-10px}.fb_dialog_bottom_right{background:url(http://static.xx.fbcdn.net/rsrc.php/v3/ye/r/8YeTNIlTZjm.png) no-repeat 0 -30px;right:-10px;bottom:-10px}.fb_dialog_vert_left,.fb_dialog_vert_right,.fb_dialog_horiz_top,.fb_dialog_horiz_bottom{position:absolute;background:#525252;filter:alpha(opacity=70);opacity:.7}.fb_dialog_vert_left,.fb_dialog_vert_right{width:10px;height:100%}.fb_dialog_vert_left{margin-left:-10px}.fb_dialog_vert_right{right:0;margin-right:-10px}.fb_dialog_horiz_top,.fb_dialog_horiz_bottom{width:100%;height:10px}.fb_dialog_horiz_top{margin-top:-10px}.fb_dialog_horiz_bottom{bottom:0;margin-bottom:-10px}.fb_dialog_iframe{line-height:0}.fb_dialog_content .dialog_title{background:#6d84b4;border:1px solid #365899;color:#fff;font-size:14px;font-weight:bold;margin:0}.fb_dialog_content .dialog_title>span{background:url(http://static.xx.fbcdn.net/rsrc.php/v3/yd/r/Cou7n-nqK52.gif) no-repeat 5px 50%;float:left;padding:5px 0 7px 26px}body.fb_hidden{-webkit-transform:none;height:100%;margin:0;overflow:visible;position:absolute;top:-10000px;left:0;width:100%}.fb_dialog.fb_dialog_mobile.loading{background:url(http://static.xx.fbcdn.net/rsrc.php/v3/ya/r/3rhSv5V8j3o.gif) white no-repeat 50% 50%;min-height:100%;min-width:100%;overflow:hidden;position:absolute;top:0;z-index:10001}.fb_dialog.fb_dialog_mobile.loading.centered{width:auto;height:auto;min-height:initial;min-width:initial;background:none}.fb_dialog.fb_dialog_mobile.loading.centered #fb_dialog_loader_spinner{width:100%}.fb_dialog.fb_dialog_mobile.loading.centered .fb_dialog_content{background:none}.loading.centered #fb_dialog_loader_close{color:#fff;display:block;padding-top:20px;clear:both;font-size:18px}#fb-root #fb_dialog_ipad_overlay{background:rgba(0, 0, 0, .45);position:absolute;bottom:0;left:0;right:0;top:0;width:100%;min-height:100%;z-index:10000}#fb-root #fb_dialog_ipad_overlay.hidden{display:none}.fb_dialog.fb_dialog_mobile.loading iframe{visibility:hidden}.fb_dialog_content .dialog_header{-webkit-box-shadow:white 0 1px 1px -1px inset;background:-webkit-gradient(linear, 0% 0%, 0% 100%, from(#738ABA), to(#2C4987));border-bottom:1px solid;border-color:#1d4088;color:#fff;font:14px Helvetica, sans-serif;font-weight:bold;text-overflow:ellipsis;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0;vertical-align:middle;white-space:nowrap}.fb_dialog_content .dialog_header table{-webkit-font-smoothing:subpixel-antialiased;height:43px;width:100%}.fb_dialog_content .dialog_header td.header_left{font-size:12px;padding-left:5px;vertical-align:middle;width:60px}.fb_dialog_content .dialog_header td.header_right{font-size:12px;padding-right:5px;vertical-align:middle;width:60px}.fb_dialog_content .touchable_button{background:-webkit-gradient(linear, 0% 0%, 0% 100%, from(#4966A6), color-stop(.5, #355492), to(#2A4887));border:1px solid #29487d;-webkit-background-clip:padding-box;-webkit-border-radius:3px;-webkit-box-shadow:rgba(0, 0, 0, .117188) 0 1px 1px inset, rgba(255, 255, 255, .167969) 0 1px 0;display:inline-block;margin-top:3px;max-width:85px;line-height:18px;padding:4px 12px;position:relative}.fb_dialog_content .dialog_header .touchable_button input{border:none;background:none;color:#fff;font:12px Helvetica, sans-serif;font-weight:bold;margin:2px -12px;padding:2px 6px 3px 6px;text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}.fb_dialog_content .dialog_header .header_center{color:#fff;font-size:16px;font-weight:bold;line-height:18px;text-align:center;vertical-align:middle}.fb_dialog_content .dialog_content{background:url(http://static.xx.fbcdn.net/rsrc.php/v3/y9/r/jKEcVPZFk-2.gif) no-repeat 50% 50%;border:1px solid #555;border-bottom:0;border-top:0;height:150px}.fb_dialog_content .dialog_footer{background:#f6f7f9;border:1px solid #555;border-top-color:#ccc;height:40px}#fb_dialog_loader_close{float:left}.fb_dialog.fb_dialog_mobile .fb_dialog_close_button{text-shadow:rgba(0, 30, 84, .296875) 0 -1px 0}.fb_dialog.fb_dialog_mobile .fb_dialog_close_icon{visibility:hidden}#fb_dialog_loader_spinner{animation:rotateSpinner 1.2s linear infinite;background-color:transparent;background-image:url(http://static.xx.fbcdn.net/rsrc.php/v3/yD/r/t-wz8gw1xG1.png);background-repeat:no-repeat;background-position:50% 50%;height:24px;width:24px}@keyframes rotateSpinner{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}
.fb_iframe_widget{display:inline-block;position:relative}.fb_iframe_widget span{display:inline-block;position:relative;text-align:justify}.fb_iframe_widget iframe{position:absolute}.fb_iframe_widget_fluid_desktop,.fb_iframe_widget_fluid_desktop span,.fb_iframe_widget_fluid_desktop iframe{max-width:100%}.fb_iframe_widget_fluid_desktop iframe{min-width:220px;position:relative}.fb_iframe_widget_lift{z-index:1}.fb_hide_iframes iframe{position:relative;left:-10000px}.fb_iframe_widget_loader{position:relative;display:inline-block}.fb_iframe_widget_fluid{display:inline}.fb_iframe_widget_fluid span{width:100%}.fb_iframe_widget_loader iframe{min-height:32px;z-index:2;zoom:1}.fb_iframe_widget_loader .FB_Loader{background:url(http://static.xx.fbcdn.net/rsrc.php/v3/y9/r/jKEcVPZFk-2.gif) no-repeat;height:32px;width:32px;margin-left:-16px;position:absolute;left:50%;z-index:4}</style><script type="text/javascript" charset="UTF-8" src="./Matrix exponentiation _ HackerEarth_files/common.js"></script><script type="text/javascript" charset="UTF-8" src="./Matrix exponentiation _ HackerEarth_files/util.js"></script><script type="text/javascript" charset="UTF-8" src="./Matrix exponentiation _ HackerEarth_files/stats.js"></script><script type="text/javascript" charset="UTF-8" src="./Matrix exponentiation _ HackerEarth_files/AuthenticationService.Authenticate"></script></head>

    <body><div id="MathJax_Message" style="display: none;"></div>

        
        
        <!-- Google Tag Manager (noscript) -->
        <noscript>
            &lt;iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PBHB3B9"
            height="0" width="0" style="display:none;visibility:hidden"&gt;&lt;/iframe&gt;
        </noscript>
        <!-- End Google Tag Manager (noscript) -->
        
        

        <!-- Placeholder for any error message on the site -->
        
        <div id="alert-message-holder">
            

            <!-- put a dummy message box so that it can be used when cloning
                 and adding more -->
            
        <div class="alert-message hidden">
                <div class="message float-left"></div>
                <div class="cross-holder float-left"><span class="small-cross sprites"></span></div>
                <div class="clear"></div>
            </div></div> <!-- end alert-message-holder -->
        

        
    <div id="top-prompt-container" class="hidden prompt-container"></div>
    <div id="right-prompt-container" class="hidden prompt-container"></div>
    <div id="center-modal-prompt-container" class="hidden prompt-container"></div>
    
    
        
        <header class="header">
            <i class="fa fa-bars mobile-menu-btn"></i>
            <nav class="navigation">
                
                <a href="https://www.hackerearth.com/" class="logo logo-h-terminal no-underline float-left track-header-logo"></a>
                

                
                <ul class="nav-bar no-padding float-left tablet-hide">
                    <!-- challenges page -->
                    <li id="challenges" class="nav-bar-menu "><a class="track-header-challenges" href="https://www.hackerearth.com/challenges/">CHALLENGES</a></li>
                    <!-- hackathons page -->
                    
                    <!-- practice page -->
                    <li id="problems" class="nav-bar-menu "><a class="track-header-problems" href="https://www.hackerearth.com/practice/">PRACTICE</a></li>
                    <!-- companies page -->
                    <li id="companies" class="nav-bar-menu "><a class="track-header-companies" href="https://www.hackerearth.com/companies/">COMPANIES</a></li>
                </ul>
                <ul class="nav-bar right-nav-bar no-padding float-right tablet-hide">
                    
                    
                    <li id="searchbar">
                        <div id="search-icon-container" class="float-left">
                            <i class="fa fa-search"></i>
                        </div>
                        <input id="searchbar-input" class="float-left" type="text" value="" name="q" autocomplete="off" spellcheck="false" placeholder="Search developers, problems, etc" ajax1="/search/AJAX/search/" ajax2="/search/search-results/">
                        <div id="search-dropdown"></div>
                    </li>
                    
                    

                    <li id="header-circle" class="">
                        <a class="tool-tip notification-icon" href="https://www.hackerearth.com/circles/">
                            <img src="./Matrix exponentiation _ HackerEarth_files/circle-header.png" alt="circle" class="margin-top-8 header-circle-img">
                        </a>
                    </li>

                    

                    


                    

                    

                    
                    <li class="nav-bar-menu login-menu-btn"><a target="login-modal" class="track-header-login show-modal">LOGIN</a></li>
                    <li class="nav-bar-menu signup-menu-btn"><a target="login-modal" class="track-header-signup show-modal show-signup-in-modal">SIGN UP</a></li>
                    

                    <div class="clear"></div>
                </ul> <!-- nav-bar -->
                <div class="clear"></div>
                
            </nav> <!-- navigation -->

            <i class="fa fa-filter challenge-filter-btn hidden"></i>

        </header> <!-- header -->
        
    
    

    
    
    <div class="top-banner">
        <p class="banner-text login-banner dark">
        
         Signup and get free access to 100+ Tutorials and Practice Problems <a class="button btn-orange-bright inline-block medium-margin-left show-modal show-signup-in-modal" target="login-modal">Start Now</a>
        
        </p>
    </div>
    
    

    

    <div id="comment-share-modal" class="modal-window small-modal">
        <div class="modal-header">
            Comment permalink
        </div>
        <div class="modal-content">
            <div class="comment-share-wrapper align-center">
                <textarea class="comment-share-text" type="textbox" rows="4" readonly="readonly" onclick="this.select();"></textarea>
            </div>
        </div>
    </div>

    
    

    
    <!-- live events widget -->
    <div id="live-events-trigger-data">



<div id="live-events-container" class="live-events">
    <div class="green-color pagelet-hover" id="live-events-placeholder" ajax="/AJAX/live_events_widget/" target="live-events-loading">
        <span>Live Events</span>
        <span id="live-events-widget-count">5</span>
    </div>
    <!-- This div is used for spacing between top and bottom borders while scrolling.-->
    <div id="live-events-loading">
    </div>
</div>

</div>
    

    <!-- This is the center page which has a fixed width of 1100px -->
    
<div class="responsive-page denim-gray-texture">
    <div class="responsive-container">
        <div class="page-data">
            <div class="left medium-margin">
                <div class="notes-header content weight-600 large" id="notes-left-container">
                    <a href="https://www.hackerearth.com/practice/notes/"><i class="fa fa-long-arrow-left"></i> Notes</a>
                    
            </div> <!--heading-2 -->
            <div class="clear"></div>

            




<div class="note-container">
    <div class="note-title-container content">
        
        
        <div class="notes-vote regular align-center light">
            <span class="polls">
                <a href="https://www.hackerearth.com/practice/notes/matrix-exponentiation-1/#" class="anon-polls-up light show-modal inline-block show-signup-in-modal" target="login-modal"><i class="fa fa-caret-up fa-lg fa-3x"></i></a>
                <br>
                <span class="polls-count only-positive inline-block dark">58 </span>
            </span>
        </div> <!-- end of notes-vote -->
        
        

        

        <div class="notes-item standard-margin-left">
            <div class="notes-title">
             Matrix exponentiation
            </div>
            <div class="notes-description">
                    
                    <div class="less-margin tags-list">
                    
                        
                        
                        <div class="note-tags dark smaller float-left medium-margin-right"> Matrix exponentiation</div>
                        
                        
                        
                        <div class="note-tags dark smaller float-left medium-margin-right"> Matrix multiplication</div>
                        
                        
                        
                        <div class="note-tags dark smaller float-left medium-margin-right"> CodeMonk</div>
                        
                        
                        
                        <div class="note-tags dark smaller float-left medium-margin-right"> Code Monk</div>
                        
                        
                        
                        <div class="note-tags dark smaller float-left medium-margin-right"> Math</div>
                        
                        
                        
                        <div class="note-tags dark smaller float-left medium-margin-right"> Dynamic Programming</div>
                        
                        
                    
                        </div> <!-- tags-list -->
                    
                    
                    <div class="clear"></div>

            </div> <!-- notes-description -->
        </div><!-- notes-tem -->
    </div> <!-- note-title-container -->

    <hr class="hr-dashed">

    <div class="regular darker note-body content">
        <h2>Introduction</h2>
<p>Matrix is a popular math object. It is basically a two-dimensional table of numbers. In this article we’ll look at integer matrices, i.e. tables with integers. This is how matrices are usually pictured:
<img alt="nxm matrix" src="./Matrix exponentiation _ HackerEarth_files/ac339f1.png"><br>
<strong>A</strong> is the matrix with n rows and m columns. Each integer in A is represented as <strong>a<sub>ij</sub></strong>: i is the row number (ranging from 1 to n), j is the column number (ranging from 1 to m).   </p>
<p>Matrices appear very frequently in computer science, with notable examples being:</p>
<ol>
<li>Adjacency matrix of a graph;</li>
<li>Matrix of system of linear equations;</li>
<li>Matrices of affine transformations in 3D graphics;</li>
<li>Probability vectors, defining probability mass function of discrete random variable.</li>
</ol>
<p>Even if you don’t know linear algebra (where matrices are heavily studied) or anything like that, I bet you’ve used matrices at least once. This happens every time when you define a 2D-array! <br>
Let’s say you have declared a variable like this (in C++):  </p>
<pre class="prettyprint prettyprinted"><code><span class="kwd">int</span><span class="pln"> arr</span><span class="pun">[</span><span class="lit">1000</span><span class="pun">][</span><span class="lit">1000</span><span class="pun">];</span></code></pre>
<p>Then you can write something like this:</p>
<pre class="prettyprint prettyprinted"><code><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
  </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++)</span><span class="pln">
    cin </span><span class="pun">&gt;&gt;</span><span class="pln"> arr</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">];</span></code></pre>
<p>To access 2D-array <strong>arr</strong>, you use two integers [i][j]. It is exactly the same as with matrix, where you need to specify row number and column number to pinpoint one element. One conclusion from this paragraph: you can <strong>represent matrices in code</strong> with 2D-arrays.  </p>
<p>Surprisingly, in competitive programming matrices can appear too. There are 10 problems with tag “Matrix exponentiation” on HackerEarth (at the time of writing). 8 of them also have tag “Hard”. If you become familiar with matrices and exponentiating them, those problems will become at least “Medium” for you, or even “Easy”!</p>
<h2>Matrix multiplication</h2>
<p>Consider two matrices: </p>
<ol>
<li>Matrix A have n rows and k columns;</li>
<li>Matrix B have k rows and m columns (notice that number of <strong>rows in B is the same as number of columns in A</strong>).  </li>
</ol>
<p>Then we define operation:<br>
C = A * B <strong>(matrix multiplication)</strong><br>
<img alt="matrix product" src="./Matrix exponentiation _ HackerEarth_files/4a46cae.png"><br>
such that C is a matrix with n rows and m columns, and each element of C should be computed by the following formula:<br>
<img alt="multiplication_definition" src="./Matrix exponentiation _ HackerEarth_files/d1c80e1.png"><br>
The meaning of matrix multiplication is different for different usage of matrices, so it is OK if you still have no idea how multiplication could be useful.</p>
<p>Several things to notice:</p>
<ol>
<li>Matrix C has the same number of rows as A, and the same number of columns as B;</li>
<li>Matrix C has n * m elements, each element is computed in k steps with given formula =&gt; we can obtain C in <strong>O(n * m * k)</strong>, given A and B;</li>
<li>If n = m = k (i.e. both A and B have n rows and n columns), then C has n rows and n columns, and can be computed in <strong>O(n<sup>3</sup>)</strong>.  </li>
</ol>
<p>Here are some useful properties of matrix multiplication:</p>
<ol>
<li>It is <strong>not commutative</strong>: A * B ≠ B * A in general case;</li>
<li>It is <strong>associative</strong>: A * B * C = (A * B) * C = A * (B * C) in case A * B * C exists;</li>
<li>If you have matrix with n rows and n columns, then multiplying it by <strong>I<sub>n</sub></strong> gives the same matrix, i. e. I<sub>n</sub> * A = A * I<sub>n</sub> = A. <strong>I<sub>n</sub></strong> is a matrix with n rows and n columns of such form:
<img alt="identity_matrix" src="./Matrix exponentiation _ HackerEarth_files/32ae1bd.png"></li>
</ol>
<h2>Matrix exponentiation</h2>
<p>Suppose you have a matrix A with n rows and n columns (we’ll call such matrices “<strong>square matrix of size n</strong>”). We can define matrix exponentiation as:<br>
A<sup>x</sup> = A * A * A * … * A   (x times)<br>
with special case of x = 0:<br>
A<sup>0</sup> = I<sub>n</sub><br>
Here x is non-negative integer (i. e. 0, 1, 2, 3, …). Don’t worry if this operation seem meaningless to you. Let’s now analyse how fast we can compute A<sup>x</sup>, given A and x.  </p>
<p>The brute-force solution would be (written in pseudo code):</p>
<pre class="prettyprint prettyprinted"><code><span class="kwd">function</span><span class="pln"> matrix_power_naive</span><span class="pun">(</span><span class="pln">A</span><span class="pun">,</span><span class="pln"> x</span><span class="pun">):</span><span class="pln">
  result </span><span class="pun">=</span><span class="pln"> I_n
  </span><span class="kwd">for</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1.</span><span class="pun">.</span><span class="pln">x</span><span class="pun">:</span><span class="pln">
    result </span><span class="pun">=</span><span class="pln"> result </span><span class="pun">*</span><span class="pln"> A
  </span><span class="kwd">return</span><span class="pln"> result</span></code></pre>
<p>It runs in Θ(n<sup>3</sup> * x): we do x matrix multiplications on square matrices of size n, and each multiplication runs in Θ(n<sup>3</sup>).  </p>
<p>We can do better! Let’s choose <strong>x = 75</strong> as an example. Write down binary representation of x:<br>
75<sub>10</sub> = 1001011<sub>2</sub>   =&gt; 75 = 2<sup>0</sup> + 2<sup>1</sup> + 2<sup>3</sup> + 2<sup>6</sup> = 1 + 2 + 8 + 64.<br>
Now we can rewrite A<sup>x</sup> as <br>
A<sup>75</sup> = A<sup>1</sup> * A<sup>2</sup> * A<sup>8</sup> * A<sup>64</sup>. There are a lot less multiples, don’t you think? We had 75 of them, now we’ve got <strong>only 4</strong>, which is a number of 1’s in binary representation of our x.<br>
And it turns out, we can find A<sup>2<sup>r</sup></sup> really fast for any r:<br>
A<sup>2<sup>0</sup></sup> = A<sup>1</sup> = A  (zero steps)<br>
A<sup>2<sup>1</sup></sup> = A<sup>2<sup>0</sup> * 2</sup> = A<sup>2<sup>0</sup> + 2<sup>0</sup></sup> = A<sup>2<sup>0</sup></sup> * A<sup>2<sup>0</sup></sup> (one multiplication - n<sup>3</sup> steps)<br>
A<sup>2<sup>2</sup></sup> = A<sup>2<sup>1</sup> * 2</sup> = A<sup>2<sup>1</sup> + 2<sup>1</sup></sup> = A<sup>2<sup>1</sup></sup> * A<sup>2<sup>1</sup></sup> (one multiplication - 2 * n<sup>3</sup> steps)<br>
… (computations happen) ...<br>
A<sup>2<sup>r</sup></sup> = A<sup>2<sup>r - 1</sup> * 2</sup> = A<sup>2<sup>r - 1</sup> + 2<sup>r - 1</sup></sup> = A<sup>2<sup>r - 1</sup></sup> * A<sup>2<sup>r - 1</sup></sup> (one multiplication - r * n<sup>3</sup> steps) <br>
Therefore, we can find A<sup>2<sup>r</sup></sup> in <strong>O(r * n<sup>3</sup>)</strong> time, given A and r.  Notice, however, that r = O(log(x)), because we compute A<sup>2<sup>r</sup></sup> only when there is r’th bit is set to 1 in binary representation of x, and length of binary representation of x is not more than log<sub>2</sub>(x) + 1.  </p>
<p>So, for x = 75 we compute A<sup>2</sup>, A<sup>4</sup>, A<sup>8</sup>, A<sup>16</sup>, A<sup>32</sup>, A<sup>64</sup> (that’s the fastest way we can get A<sup>64</sup>) in 6 * n<sup>3</sup> steps, then perform 4 multiplications (I<sub>n</sub> * A<sup>1</sup> * A<sup>2</sup> * A<sup>8</sup> * A<sup>64</sup>) in 4 * n<sup>3</sup> steps. In total, this gets us to <strong>10 * n<sup>3</sup> steps for computing A<sup>75</sup></strong>, instead of 75 * n<sup>3</sup> steps with brute force.   </p>
<p>We could implement this new idea in general (for any x) in the following way:</p>
<pre class="prettyprint prettyprinted"><code><span class="kwd">function</span><span class="pln"> matrix_power_smart</span><span class="pun">(</span><span class="pln">A</span><span class="pun">,</span><span class="pln"> x</span><span class="pun">):</span><span class="pln">
  result </span><span class="pun">=</span><span class="pln"> I_n
  r </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pln">
  cur_a </span><span class="pun">=</span><span class="pln"> A
  </span><span class="kwd">while</span><span class="pln"> </span><span class="lit">2</span><span class="pun">^</span><span class="pln">r </span><span class="pun">&lt;=</span><span class="pln"> x</span><span class="pun">:</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> r</span><span class="pun">’</span><span class="pln">th bit </span><span class="kwd">is</span><span class="pln"> </span><span class="kwd">set</span><span class="pln"> </span><span class="kwd">in</span><span class="pln"> x</span><span class="pun">:</span><span class="pln">
      result </span><span class="pun">=</span><span class="pln"> result </span><span class="pun">*</span><span class="pln"> cur_a
    r </span><span class="pun">+=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
    cur_a </span><span class="pun">=</span><span class="pln"> cur_a </span><span class="pun">*</span><span class="pln"> cur_a
  </span><span class="kwd">return</span><span class="pln"> result</span></code></pre>
<p>Here, on every step of the <em>while</em> loop, cur_a = A<sup>2<sup>r</sup></sup>.<br>
While the above code works, there is a more conventional way of implementing this algorithm. Instead of incrementing r, we will <strong>strip the 0’th bit from x on every iteration</strong>. And instead of checking if r’th bit is set, we must check if 0’th bit is set in x. Also, instead of having variable cur_a, we will multiply A <strong>by itself in-place</strong>.  </p>
<p>Here is the implementation:</p>
<pre class="prettyprint prettyprinted"><code><span class="kwd">function</span><span class="pln"> matrix_power_final</span><span class="pun">(</span><span class="pln">A</span><span class="pun">,</span><span class="pln"> x</span><span class="pun">):</span><span class="pln">
  result </span><span class="pun">=</span><span class="pln"> I_n
  </span><span class="kwd">while</span><span class="pln"> x </span><span class="pun">&gt;</span><span class="pln"> </span><span class="lit">0</span><span class="pun">:</span><span class="pln">
    </span><span class="kwd">if</span><span class="pln"> x </span><span class="pun">%</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">==</span><span class="pln"> </span><span class="lit">1</span><span class="pun">:</span><span class="pln">
      result </span><span class="pun">=</span><span class="pln"> result </span><span class="pun">*</span><span class="pln"> A
    A </span><span class="pun">=</span><span class="pln"> A </span><span class="pun">*</span><span class="pln"> A
    x </span><span class="pun">=</span><span class="pln"> x </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pln">
  </span><span class="kwd">return</span><span class="pln"> result</span></code></pre>
<p>Major conclusion here: we can find <strong>A<sup>x</sup> for any integer x in O(n<sup>3</sup> * log<sub>2</sub>x)</strong> time.</p>
<h2>Applications of matrix exponentiation</h2>
<p></p><h3>Finding N’th Fibonacci number</h3><br>
Fibonacci numbers <strong>F<sub>n</sub></strong> are defined as follows:<p></p>
<ol>
<li>F<sub>0</sub> =  F<sub>1</sub> = 1;</li>
<li>F<sub>i</sub> =  F<sub>i - 1</sub> +  F<sub>i - 2</sub> for i ≥ 2.  </li>
</ol>
<p>We want to find F<sub>N</sub> modulo 1000000007, where <strong>N</strong> can be up to 10<sup>18</sup>.  </p>
<p>The first thing that comes to mind is to run a <em>for</em> loop, according to the definition:</p>
<pre class="prettyprint prettyprinted"><code><span class="kwd">function</span><span class="pln"> fibonacci_definition</span><span class="pun">(</span><span class="pln">N</span><span class="pun">):</span><span class="pln">
  </span><span class="kwd">if</span><span class="pln"> N </span><span class="pun">&lt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">:</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
  x </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
  y </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
  </span><span class="kwd">for</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0.</span><span class="pun">.</span><span class="pln">N</span><span class="pun">-</span><span class="lit">2</span><span class="pun">:</span><span class="pln">
    next_y </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">x </span><span class="pun">+</span><span class="pln"> y</span><span class="pun">)</span><span class="pln"> mod </span><span class="lit">1000000007</span><span class="pln">
    x </span><span class="pun">=</span><span class="pln"> y
    y </span><span class="pun">=</span><span class="pln"> next_y
  </span><span class="kwd">return</span><span class="pln"> y</span></code></pre>
<p>After i’th iteration of <em>for</em> loop, we maintain x = F<sub>i + 1</sub> and y = F<sub>i + 2</sub>. As the last iteration is N-2’th, we get y = F<sub>N - 2 + 2</sub>  = F<sub>N</sub> when we return from the function.<br>
The running time of this loop is clearly <strong>O(N)</strong>. This can work in reasonable time for N up to 10<sup>9</sup>. If we want N up to 10<sup>18</sup>, we have to switch to a faster approach.  </p>
<p>Here is when matrices get involved. Suppose we have a <strong>vector</strong> (matrix with one row and several columns) of (F<sub>i - 2</sub>, F<sub>i - 1</sub>) and we want to multiply it by some matrix, so that we get (F<sub>i - 1</sub>, F<sub>i</sub>). Let’s call this matrix <strong>M</strong>:<br>
<img alt="fibo_matrix_abstract" src="./Matrix exponentiation _ HackerEarth_files/8b32b8c.png"><br>
Two questions arise immediately:</p>
<ol>
<li>What are the dimensions of M?</li>
<li>What are exact values in M?</li>
</ol>
<p>We can answer them, using the definition of matrix multiplication:  </p>
<ol>
<li><strong>The size</strong>. We multiply the  (F<sub>i - 2</sub>, F<sub>i - 1</sub>), which has 1 row and 2 columns, by M. The result is (F<sub>i - 1</sub>, F<sub>i</sub>), which has 1 row and 2 columns.<br>
 By definition, if we multiply a matrix with n rows and k columns by a matrix with k rows and m columns, we get a matrix with n rows and m columns.<br>
 In our case, n = 1, k = 2 (number of rows and columns of (F<sub>i - 2</sub>, F<sub>i - 1</sub>)), and m = 2 (number of columns in the resulting (F<sub>i - 1</sub>, F<sub>i</sub>)).<br>
 Therefore, M has <strong>k = 2 rows and m = 2 columns</strong>.</li>
<li><strong>Values</strong>. We now know that M has 2 rows and 2 columns, 4 values overall. Let’s denote them by letters, as we usually do with unknown variables:<br>
<img alt="fibo_matrix_values_abstract" src="./Matrix exponentiation _ HackerEarth_files/ddf3976.png"><br>
    We want to find x, y, z and w. Let’s see what we get, if we multiply  (F<sub>i - 2</sub>, F<sub>i - 1</sub>) by M by definition:<br>
<img alt="fibo_matrix_mult" src="./Matrix exponentiation _ HackerEarth_files/f8b9bef.png"><br>
    On the other hand, we know that the result of this multiplication must be (F<sub>i - 1</sub>, F<sub>i</sub>):<br>
<img alt="fibo_matrix_equation" src="./Matrix exponentiation _ HackerEarth_files/11c1866.png"><br>
    Now we can write the system of equations:
    F<sub>i - 2 </sub>* x + F<sub>i - 1</sub> * z = F<sub>i - 1</sub><br>
    F<sub>i - 2</sub> * y + F<sub>i - 1</sub> * w = F<sub>i</sub><br>
    The easiest way to satisfy the first equation is to set <strong>x = 0, z = 1</strong>.<br>
    For the second equation, we look at the definition of Fibonacci numbers:<br>
    F<sub>i</sub> = F<sub>i - 1</sub> + F<sub>i - 2</sub><br>
    So the solution is <strong>y = 1, w = 1</strong>.</li>
</ol>
<p>Now we know the size and contents of M:<br>
<img alt="fibo_matrix_answer" src="./Matrix exponentiation _ HackerEarth_files/59391ca.png"><br>
You may wonder why on Earth would we need to overcomplicate the problem, introduce matrices, etc.? You’ll see why in a moment.<br>
Initially, we have F<sub>0</sub> and F<sub>1</sub>. Arrange them as a vector:<br>
<img alt="fibo_initial_vector" src="./Matrix exponentiation _ HackerEarth_files/6ae6895.png"><br>
Multiplying this vector with the matrix M will get us to (F<sub>1</sub>, F<sub>2</sub>) = (1, 2):<br>
<img alt="fibo_f1_f2" src="./Matrix exponentiation _ HackerEarth_files/803c518.png"><br>
If we multiply (1, 2) with M, we get (F<sub>2</sub>, F<sub>3</sub>) = (2, 3):<br>
<img alt="fibo_f2_f3" src="./Matrix exponentiation _ HackerEarth_files/8c3a5a5.png"><br>
 But we could get the same result by multiplying (1, 1) by M two times:<br>
<img alt="fibo_two_times" src="./Matrix exponentiation _ HackerEarth_files/99b8936.png"> </p>
<p>In general, multiplying k times by M gives us F<sub>k</sub>, F<sub>k + 1</sub>:<br>
<img alt="fibo_k_times" src="./Matrix exponentiation _ HackerEarth_files/aad8ac0.png"><br>
Here matrix exponentiation comes into play: <strong>multiplying k times by M is equal to multiplying by M<sup>k</sup></strong>: <br>
<img alt="fibo_mk" src="./Matrix exponentiation _ HackerEarth_files/c08d084.png"><br>
Computing M<sup>k</sup> takes O((size of M)<sup>3</sup> * log(k)) time. In our problem, size of M is 2, so we can find N’th Fibonacci number in O(2<sup>3</sup> * log(N)) = <strong>O(log(N))</strong>:  </p>
<pre class="prettyprint prettyprinted"><code><span class="kwd">function</span><span class="pln"> fibonacci_exponentiation</span><span class="pun">(</span><span class="pln">N</span><span class="pun">):</span><span class="pln">
  </span><span class="kwd">if</span><span class="pln"> N </span><span class="pun">&lt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">:</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
  initial </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
  exp </span><span class="pun">=</span><span class="pln"> matrix_power_with_modulo</span><span class="pun">(</span><span class="pln">M</span><span class="pun">,</span><span class="pln"> N </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1000000007</span><span class="pun">)</span><span class="pln"> </span><span class="com">// assuming we’ve defined M</span><span class="pln">
  </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">(</span><span class="pln">initial </span><span class="pun">*</span><span class="pln"> exp</span><span class="pun">)[</span><span class="lit">1</span><span class="pun">][</span><span class="lit">2</span><span class="pun">]</span><span class="pln"> modulo </span><span class="lit">1000000007</span></code></pre>
<p>We multiply our initial vector (1, 1) by M<sup>N - 1</sup> and get initial * exp = (F<sub>N - 1</sub>, F<sub>N</sub>). We must return F<sub>N</sub>, so we take it from first row, second column of initial * exp. All indexation is done starting from 1.  </p>
<h3>Finding N’th element of linear recurrent sequence</h3>
<p>Let’s take a look at more general problem than before. Sequence <strong>A</strong> satisfies two properties:</p>
<ol>
<li>A<sub>i</sub> = c<sub>1</sub> * A<sub>i - 1</sub> + c<sub>2</sub> * A<sub>i - 2</sub> + … + c<sub>k</sub> * A<sub>i - k</sub> for i ≥ k (c<sub>1</sub>, c<sub>2</sub> …, c<sub>k</sub> are given integers);</li>
<li>A<sub>0</sub> = a<sub>0</sub>, A<sub>1</sub> = a<sub>1</sub>, …, A<sub>k - 1</sub> = a<sub>k - 1</sub> (a<sub>0</sub>, a<sub>1</sub>, …, a<sub>k - 1</sub> are given integers).<br>
We need to find A<sub>N</sub> modulo 1000000007, when <strong>N</strong> is up to 10<sup>18</sup> and <strong>k</strong> up to 50.  </li>
</ol>
<p><em>Side note</em>: such a sequence A<sub>i</sub> is called <strong>recurrent</strong>, because computing A<sub>i</sub> requires computing A<sub>j</sub> for some j &lt; i. Also, A<sub>i</sub> is called <strong>linear</strong>, because it depends linearly on A<sub>j</sub> for some j &lt; i.    </p>
<p>Notice that if we take k = 2, a<sub>0</sub> = a<sub>1</sub> = 1, c<sub>1</sub> = c<sub>2</sub> = 1, then this sequence will be Fibonacci sequence from the previous problem.  </p>
<p>Here we will look for a solution that involves matrix multiplication right from the start. If we obtain matrix <strong>M</strong>, such that:<br>
<img alt="recurrent_matrix_def" src="./Matrix exponentiation _ HackerEarth_files/82a75be.png"><br>
then we can get A<sub>N</sub> in the following manner:<br>
<img alt="recurrent_matrix_result" src="./Matrix exponentiation _ HackerEarth_files/93fc067.png"> </p>
<p>Two questions arise:</p>
<ol>
<li>What is the number of rows and columns of M? <br>
The reasoning is the same as with Fibonacci numbers: we multiply matrix with 1 row and k columns by M, and get matrix with 1 row and k columns. <br>
Therefore, <strong>M has k rows and k columns</strong>. In other words, 
M is square matrix with size k;</li>
<li>What are the values in M? Let’s denote them as <strong>x<sub>ij</sub></strong>:<br>
<img alt="recurrent_xij" src="./Matrix exponentiation _ HackerEarth_files/b8e75ce.png"><br>
    Then we can write down equations, which are based on the definition of matrix multiplication:<br>
<img alt="recurrent_system" src="./Matrix exponentiation _ HackerEarth_files/c4fae24.png"><br>
    From the first equation it is easy to see, that <strong>x<sub>21</sub> = 1</strong> and x<sub>i1</sub> = 0 for i = 1, 3, 4, …, k.<br>
    From the second equation we conclude that <strong>x<sub>32</sub> = 1</strong> and x<sub>i2</sub> = 0 for i = 1, 2, 4, …, k.<br>
    Following this logic up to k-1’th equation, we get <strong>x<sub>i,i-1</sub> = 1</strong> for i = 2, 3, …, k and <strong>x<sub>ij</sub> = 0</strong> for i = 1, 2, 3, …, k and j ≤ k - 1, j ≠ i - 1.<br>
    The last equation looks like the definition of A<sub>i</sub>. Based on that, we get <strong>x<sub>ik</sub> = c<sub>k - i +1</sub></strong>:<br>
<img alt="recurrent_matrix_final" src="./Matrix exponentiation _ HackerEarth_files/37ba915.png"> </li>
</ol>
<p>Now, when we have M, there are no more obstacles. We can implement the solution.<br>
Pseudo code:</p>
<pre class="prettyprint prettyprinted"><code><span class="kwd">function</span><span class="pln"> recurrent_seq</span><span class="pun">(</span><span class="pln">N</span><span class="pun">,</span><span class="pln"> k</span><span class="pun">,</span><span class="pln"> a</span><span class="pun">,</span><span class="pln"> c</span><span class="pun">):</span><span class="pln"> </span><span class="com">// a and c are arrays of size k</span><span class="pln">
  </span><span class="kwd">if</span><span class="pln"> N </span><span class="pun">&lt;=</span><span class="pln"> k </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">:</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">N</span><span class="pun">]</span><span class="pln">
  M </span><span class="pun">=</span><span class="pln"> build_M</span><span class="pun">(</span><span class="pln">k</span><span class="pun">,</span><span class="pln"> c</span><span class="pun">)</span><span class="pln">
  initial </span><span class="pun">=</span><span class="pln"> a </span><span class="com">// initial vector: (a_0, a_1, …, a_{k-1})</span><span class="pln">
  exp </span><span class="pun">=</span><span class="pln"> matrix_power_with_modulo</span><span class="pun">(</span><span class="pln">M</span><span class="pun">,</span><span class="pln"> N </span><span class="pun">-</span><span class="pln"> k </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1000000007</span><span class="pun">)</span><span class="pln">
  </span><span class="kwd">return</span><span class="pln"> </span><span class="pun">(</span><span class="pln">initial </span><span class="pun">*</span><span class="pln"> exp</span><span class="pun">)[</span><span class="lit">1</span><span class="pun">][</span><span class="pln">k</span><span class="pun">]</span><span class="pln"> modulo </span><span class="lit">1000000007</span><span class="pln"> </span><span class="com">// initial*exp is a matrix (A_{N - k + 1}, A_{N - k + 2}, …, A_N). We take first row, last column as the result, which is A_N.</span></code></pre>
<p>This code will run in <strong>O(k<sup>3</sup> * log(N))</strong> if we use fast matrix exponentiation.</p>
<h3>Finding the sum of Fibonacci numbers up to N</h3>
<p>Let’s go back to Fibonacci numbers:  </p>
<ol>
<li>F<sub>0</sub> = F<sub>1</sub> = 1;</li>
<li>F<sub>i</sub> = F<sub>i - 1</sub> + F<sub>i - 2</sub> for i ≥ 2.</li>
</ol>
<p>Introduce a new sequence: <strong>P<sub>i</sub></strong> = F<sub>0</sub> + F<sub>1</sub> + … + F<sub>i</sub> (i.e. sum of first i Fibonacci numbers).<br>
The problem is: find P<sub>N</sub> modulo 1000000007 for <strong>N</strong> up to 10<sup>18</sup>.</p>
<p>Surprisingly, we can do it with matrices again. Let’s imagine we have a matrix <strong>M</strong>, such that:<br>
<img alt="sum_matrix" src="./Matrix exponentiation _ HackerEarth_files/bc9f9e1.png"><br>
Then we can obtain P<sub>N</sub> by doing:<br>
<img alt="sum_solution" src="./Matrix exponentiation _ HackerEarth_files/c54759d.png"> </p>
<p>By now you must be familiar with the method of obtaining M and determining its size. I’ll present you M right away:<br>
<img alt="sum_m" src="./Matrix exponentiation _ HackerEarth_files/d0d2aa9.png"> <br>
The first column is three 1’s, because P<sub>i</sub> = P<sub>i - 1</sub> + F<sub>i</sub> = P<sub>i - 1</sub> + F<sub>i - 2</sub> + F<sub>i - 1</sub>.  </p>
<p>You can find sum of first N numbers of <strong>any recurrent linear sequence A<sub>i</sub>, not just Fibonacci</strong>. To do that, introduce the “sum sequence” P<sub>i</sub> = A<sub>0</sub> + A<sub>1</sub> + … + A<sub>i</sub>. Put this sequence into the initial vector. Then find the matrix that gives you P<sub>i + 1</sub>, based on P<sub>i</sub> and some A’s.</p>
<h3>Computing multiple linear recurrent sequences at once</h3>
<p>Take a look at the problem <a href="https://www.hackerearth.com/problem/algorithm/candy-distribution-3-1/description/">Candy Distribution 3</a> from HackerEarth Medium Track. Basically, it asks, given integer n ≥ 10<sup>6</sup>, find the number of pairs of integers (x, y) such that:  </p>
<ol>
<li>0 ≤ x &lt; 2<sup>n</sup>;</li>
<li>0  ≤ y &lt; 2<sup>n</sup>;</li>
<li>Bitwise OR of x and y is not equal to x;</li>
<li>Bitwise OR of x and y is not equal to y.</li>
</ol>
<p>When solving this problem, I came up with the following solution: let <strong>dp<sub>i</sub></strong> be the answer for n = i. Then it can be shown that:<br>
dp<sub>i</sub> = dp<sub>i - 1</sub> * 4 +  g<sub>i - 1</sub> * 2 for i &gt; 1,<br>
dp<sub>1</sub> = 0, <br>
where sequence <strong>g</strong> satisfies:<br>
g<sub>i</sub> = g<sub>i - 1</sub> * 3 + 2<sup>i - 1</sup> for i &gt; 1, <br>
g<sub>1</sub> = 1.</p>
<p><em>Side note</em>: this is not the only way to solve this problem. For example, there is another approach proposed in the editorial. Also, due to this specific problem constraints’ (namely, up to 10<sup>6</sup> inputs for each test), it can not be accepted with matrix exponentiation.</p>
<p>There are 3 recurrent sequences involved: dp<sub>i</sub> depends on g<sub>i - 1</sub>, g<sub>i</sub> depends on 2<sup>i - 1</sup> (powers of two can be viewed as recurrent sequence <strong>P<sub>i</sub></strong>: P<sub>0</sub> = 1, P<sub>i</sub> = 2 * P<sub>i - 1</sub>). <strong>What if we want to compute dp<sub>n</sub> using matrix exponentiation</strong>?  </p>
<p>Find a matrix <strong>M</strong>, such that:<br>
<img alt="candy_transition" src="./Matrix exponentiation _ HackerEarth_files/b033823.png"><br>
One can see that:  <br>
<img alt="candy_matrix" src="./Matrix exponentiation _ HackerEarth_files/ba162d1.png"> </p>
<p>How to come up with M without much thinking? <br>
Notice, that in the first column we have 4, 2 and 0. This is precisely because <br>
dp<sub>i</sub> = dp<sub>i - 1</sub> * <strong>4</strong> + g<sub>i - 1</sub> * <strong>2</strong> + 2<sup>i - 1</sup> * <strong>0</strong><br>
Generally, if the value at row i and column j equals x, then i’th column of initial vector has the coefficient x when calculating j’th column of resulting vector. For example, value in first row and third column is 0, because 2<sup>i</sup> = <strong>0</strong> * dp<sub>i - 1</sub> + … .</p>
<p>The answer for this problem would be the first row and first column of<br>
<img alt="candy_answer" src="./Matrix exponentiation _ HackerEarth_files/ee35218.png"> </p>
<h3>Solving dynamic programming problems with fixed linear transitions</h3>
<p>Let’s take a look at another HackerEarth problem: <a href="https://www.hackerearth.com/problem/algorithm/pk-and-interesting-language/description/">PK and interesting language</a>. It goes like this:  </p>
<blockquote>
<p>Count the number of strings of length L with lowercase english
letters, if some pairs of letters can not appear consequently in those
strings. L is up to 10<sup>7</sup>, there are up to 100 inputs.</p>
</blockquote>
<p>The “<strong>banned</strong>” pairs are described in the input as matrix: banned[i][j] == 0 means that letter j can not go after letter i in a valid string. Otherwise, banned[i][j] == 1.  </p>
<p>Let <strong>dp[n][last_letter]</strong> be the number of valid strings of length <strong>n</strong>, which have last letter equal to <strong>last_letter</strong>. Then we can recalculate dp in order of increasing n:  </p>
<pre class="prettyprint prettyprinted"><code><span class="pln">dp</span><span class="pun">[</span><span class="lit">1</span><span class="pun">][</span><span class="pln">a</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> dp</span><span class="pun">[</span><span class="lit">1</span><span class="pun">][</span><span class="pln">b</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">…</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> dp</span><span class="pun">[</span><span class="lit">1</span><span class="pun">][</span><span class="pln">z</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pln">
</span><span class="kwd">for</span><span class="pln"> n </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2.</span><span class="pun">.</span><span class="pln">L</span><span class="pun">:</span><span class="pln">
  </span><span class="kwd">for</span><span class="pln"> last_letter </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">..</span><span class="pln">z</span><span class="pun">:</span><span class="pln">
    </span><span class="kwd">for</span><span class="pln"> next_letter </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">..</span><span class="pln">z</span><span class="pun">:</span><span class="pln">
      </span><span class="kwd">if</span><span class="pln"> banned</span><span class="pun">[</span><span class="pln">last_letter</span><span class="pun">][</span><span class="pln">next_letter</span><span class="pun">]</span><span class="pln"> </span><span class="pun">!=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">:</span><span class="pln">
        dp</span><span class="pun">[</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">][</span><span class="pln">next_letter</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> dp</span><span class="pun">[</span><span class="pln">n</span><span class="pun">][</span><span class="pln">last_letter</span><span class="pun">]</span></code></pre>
<p>The logic behind this is such: if we have the number of valid strings for some <strong>n</strong> and <strong>last_letter</strong> (it is <strong>dp[n][last_letter]</strong>), then we can add some letter to the end of those strings. Let’s iterate over this new letter <strong>next_letter</strong> and see if it is OK to place it after <strong>last_letter</strong>. If it is, then adding <strong>next_letter</strong> will result in the string of length <strong>n + 1</strong> with last letter equal to <strong>next_letter</strong>. Thus, we add dp[n][last_letter] to dp[n + 1][next_letter].  </p>
<p>The above approach works in Θ(L * 26<sup>2</sup>) time and won’t pass with L ~ 10<sup>7</sup>.  </p>
<p>To speed things up, notice that inside the<br>
for n = 2..L<br>
loop <strong>nothing depends on n itself!</strong> Well, you could argue that writing “dp[n + 1][next_letter] += dp[n][last_letter]” and then saying “it does not depend on n” is nonsense. What I want to stress out is that <strong>transition from n to n + 1 happens in exactly the same way like, for example, from n + 100 to n + 101</strong>. The “banned” rules do not change over time! </p>
<p>The second observation would be: transition formulas from n to n + 1 are <strong>linear</strong>. To compute dp[n + 1][next_letter], we sum up dp[n][letter] for some <em>letter</em>. We do not have something like<br>
dp[n + 1][next_letter] += dp[n][letter] * dp[n][next_letter],<br>
which would mean that transition is not linear.</p>
<p>These two observations combined provide a useful property: there exists some matrix M, such that for any n ≥ 1
<img alt="language_exists" src="./Matrix exponentiation _ HackerEarth_files/9f7e2e6.png"> </p>
<p>By now you should be able to tell that <strong>M is a square matrix with size 26</strong> (which is number of letters in English alphabet). It contains 26 * 26 = 676 values - tough thing if you want to write them down manually!<br>
Here is the easy way to understand, which values x<sub>ij</sub> must be in M, based on the above equation:  </p>
<ol>
<li>Call the left part <strong>initial</strong> and the right part <strong>result</strong>;</li>
<li>By matrix multiplication definition we have: <br>
<img alt="language_equation" src="./Matrix exponentiation _ HackerEarth_files/f92b042.png"> </li>
<li>In other words, when you want to compute i-th value of the result, you take all x’s from i-th column and multiply them by corresponding initial’s;</li>
<li>This means that x<sub>ki</sub> is the number, which tells “how many times we need to add initial<sub>1k</sub> to result<sub>1i</sub>”. Personally, I call it “impact of k-th value on i-th value of dp”.</li>
</ol>
<p>In this problem, M is conveniently given to you in input. Indeed, we could rewrite the transition loop to this:</p>
<pre class="prettyprint prettyprinted"><code><span class="kwd">for</span><span class="pln"> last_letter </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">..</span><span class="pln">z</span><span class="pun">:</span><span class="pln">
  </span><span class="kwd">for</span><span class="pln"> next_letter </span><span class="pun">=</span><span class="pln"> a</span><span class="pun">..</span><span class="pln">z</span><span class="pun">:</span><span class="pln">
    dp</span><span class="pun">[</span><span class="pln">n </span><span class="pun">+</span><span class="pln"> </span><span class="lit">1</span><span class="pun">][</span><span class="pln">next_letter</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+=</span><span class="pln"> dp</span><span class="pun">[</span><span class="pln">n</span><span class="pun">][</span><span class="pln">last_letter</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> banned</span><span class="pun">[</span><span class="pln">last_letter</span><span class="pun">][</span><span class="pln">next_letter</span><span class="pun">]</span></code></pre>
<p>That’s because “banned” is given in binary form: 1 if letters can appear together, 0 in other case.<br>
The states of dynamic programming here are letters, and matrix “banned” shows how one letter affect the other. The final solution is:<br>
<img alt="language_solution" src="./Matrix exponentiation _ HackerEarth_files/3af8bef.png"><br>
It works in <strong>O(26<sup>3</sup> * log(L))</strong>, which is significantly faster and passes time limit.  </p>
<p>This way of speeding up dynamic programming is crucial to understand. <strong>Most of the problems tagged “Matrix exponentiation” on HackerEarth can be solved with this trick.</strong></p>
<h2>Implementation</h2>
<p>Generally, you’d want to express three functions in your code:</p>
<ol>
<li>Multiply two matrices of appropriate sizes;</li>
<li>Create an identity matrix <strong>I<sub>n</sub></strong>;</li>
<li>Raise a matrix to r-th power using fast exponentiation.
Also you should consider a way to store your matrix.</li>
</ol>
<p>The most straight-forward approach is to store matrices as 2D-arrays:</p>
<pre class="prettyprint prettyprinted"><code><span class="kwd">int</span><span class="pln"> matrix_1</span><span class="pun">[</span><span class="lit">50</span><span class="pun">][</span><span class="lit">50</span><span class="pun">];</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> matrix_2</span><span class="pun">[</span><span class="lit">50</span><span class="pun">][</span><span class="lit">50</span><span class="pun">];</span></code></pre>
<p>While the easiest way to perform multiplication is to use hard-coded operands:  </p>
<pre class="prettyprint prettyprinted"><code><span class="kwd">int</span><span class="pln"> mat_a</span><span class="pun">[</span><span class="lit">50</span><span class="pun">][</span><span class="lit">50</span><span class="pun">],</span><span class="pln"> mat_b</span><span class="pun">[</span><span class="lit">50</span><span class="pun">][</span><span class="lit">50</span><span class="pun">];</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> mul</span><span class="pun">()</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
  </span><span class="com">// multiplies mat_a by mat_b</span><span class="pln">
</span><span class="pun">}</span></code></pre>
<p>For example, it could look like this:</p>
<pre class="prettyprint prettyprinted"><code><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> MAX_SIZE </span><span class="pun">=</span><span class="pln"> </span><span class="lit">50</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> MOD </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1e9</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">7</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">MAX_SIZE</span><span class="pun">][</span><span class="pln">MAX_SIZE</span><span class="pun">];</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">MAX_SIZE</span><span class="pun">][</span><span class="pln">MAX_SIZE</span><span class="pun">];</span><span class="pln">
</span><span class="kwd">int</span><span class="pln"> tmp</span><span class="pun">[</span><span class="pln">MAX_SIZE</span><span class="pun">][</span><span class="pln">MAX_SIZE</span><span class="pun">];</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> mul_mat</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> n1</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> m1</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> n2</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> m2</span><span class="pun">)</span><span class="pln">
</span><span class="pun">{</span><span class="pln">   
    </span><span class="com">// Instead of passing the matrices, we pass only their dimensions.</span><span class="pln">
    </span><span class="com">// Function multiplies a by b if </span><span class="pln">
    </span><span class="com">//   a has n1 rows and m1 columns</span><span class="pln">
    </span><span class="com">//   b has n2 rows and m2 columns</span><span class="pln">
    </span><span class="com">// The result is stored in tmp matrix, then copied to a.</span><span class="pln">
    </span><span class="com">//</span><span class="pln">
    </span><span class="com">// Notice that the resulting matrix has n1 rows and m2 columns.</span><span class="pln">

    memset</span><span class="pun">(</span><span class="pln">tmp</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">sizeof</span><span class="pun">(</span><span class="pln">tmp</span><span class="pun">));</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pun">(</span><span class="pln">m1 </span><span class="pun">==</span><span class="pln"> n2</span><span class="pun">);</span><span class="pln"> </span><span class="com">// according to definition of matrix multiplication</span><span class="pln">

    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n1</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;</span><span class="pln"> m2</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
            </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> k </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> k </span><span class="pun">&lt;</span><span class="pln"> m1</span><span class="pun">;</span><span class="pln"> k</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                tmp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">tmp</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">k</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">1ll</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> b</span><span class="pun">[</span><span class="pln">k</span><span class="pun">][</span><span class="pln">j</span><span class="pun">])</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> MOD</span><span class="pun">;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="pun">}</span><span class="pln">

    memcpy</span><span class="pun">(</span><span class="pln">a</span><span class="pun">,</span><span class="pln"> tmp</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">sizeof</span><span class="pun">(</span><span class="pln">a</span><span class="pun">));</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> create_identity</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">)</span><span class="pln">
</span><span class="pun">{</span><span class="pln">   
    </span><span class="com">// Creates identity matrix I_n and stores it in a.</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++)</span><span class="pln">
            </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">i </span><span class="pun">==</span><span class="pln"> j</span><span class="pun">)</span><span class="pln">
                a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
            </span><span class="kwd">else</span><span class="pln">
                a</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre>
<p>The exponentiating function is tricky to write in such case. So, if I have enough time, I prefer to implement Matrix as a class in C++:</p>
<pre class="prettyprint prettyprinted"><code><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> MOD </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1e9</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">7</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">struct</span><span class="pln"> </span><span class="typ">Matrix</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    vector</span><span class="pun">&lt;</span><span class="pln"> vector</span><span class="str">&lt;int&gt;</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> mat</span><span class="pun">;</span><span class="pln"> </span><span class="com">// the contents of matrix as a 2D-vector</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n_rows</span><span class="pun">,</span><span class="pln"> n_cols</span><span class="pun">;</span><span class="pln"> </span><span class="com">// number of rows and columns</span><span class="pln">

    </span><span class="typ">Matrix</span><span class="pun">(</span><span class="pln">vector</span><span class="pun">&lt;</span><span class="pln"> vector</span><span class="str">&lt;int&gt;</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> values</span><span class="pun">):</span><span class="pln"> mat</span><span class="pun">(</span><span class="pln">values</span><span class="pun">),</span><span class="pln"> n_rows</span><span class="pun">(</span><span class="pln">values</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()),</span><span class="pln">
        n_cols</span><span class="pun">(</span><span class="pln">values</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">size</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">

    </span><span class="kwd">static</span><span class="pln"> </span><span class="typ">Matrix</span><span class="pln"> identity_matrix</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        </span><span class="com">// Return I_n - the identity matrix of size n.</span><span class="pln">
        </span><span class="com">// This function is static, because it creates a new Matrix instance</span><span class="pln">
        vector</span><span class="pun">&lt;</span><span class="pln"> vector</span><span class="str">&lt;int&gt;</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> values</span><span class="pun">(</span><span class="pln">n</span><span class="pun">,</span><span class="pln"> vector</span><span class="str">&lt;int&gt;</span><span class="pun">(</span><span class="pln">n</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">));</span><span class="pln">
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
            values</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> values</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="typ">Matrix</span><span class="pln"> </span><span class="kwd">operator</span><span class="pun">*(</span><span class="kwd">const</span><span class="pln"> </span><span class="typ">Matrix</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">other</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> 
    </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> n </span><span class="pun">=</span><span class="pln"> n_rows</span><span class="pun">,</span><span class="pln"> m </span><span class="pun">=</span><span class="pln"> other</span><span class="pun">.</span><span class="pln">n_cols</span><span class="pun">;</span><span class="pln">
        vector</span><span class="pun">&lt;</span><span class="pln"> vector</span><span class="str">&lt;int&gt;</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> result</span><span class="pun">(</span><span class="pln">n_rows</span><span class="pun">,</span><span class="pln"> vector</span><span class="str">&lt;int&gt;</span><span class="pun">(</span><span class="pln">m</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">));</span><span class="pln">
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
            </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;</span><span class="pln"> m</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> k </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> k </span><span class="pun">&lt;</span><span class="pln"> n_cols</span><span class="pun">;</span><span class="pln"> k</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    result</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="pun">(</span><span class="pln">result</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> mat</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">k</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">1ll</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> other</span><span class="pun">.</span><span class="pln">mat</span><span class="pun">[</span><span class="pln">k</span><span class="pun">][</span><span class="pln">j</span><span class="pun">])</span><span class="pln"> </span><span class="pun">%</span><span class="pln"> MOD</span><span class="pun">;</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">
        </span><span class="com">// Multiply matrices as usual, then return the result as the new Matrix</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> </span><span class="typ">Matrix</span><span class="pun">(</span><span class="pln">result</span><span class="pun">);</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">inline</span><span class="pln"> </span><span class="kwd">bool</span><span class="pln"> is_square</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">const</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> n_rows </span><span class="pun">==</span><span class="pln"> n_cols</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">};</span><span class="pln">

</span><span class="typ">Matrix</span><span class="pln"> fast_exponentiation</span><span class="pun">(</span><span class="typ">Matrix</span><span class="pln"> m</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> power</span><span class="pun">)</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pun">(</span><span class="pln">m</span><span class="pun">.</span><span class="pln">is_square</span><span class="pun">());</span><span class="pln">
    </span><span class="typ">Matrix</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Matrix</span><span class="pun">::</span><span class="pln">identity_matrix</span><span class="pun">(</span><span class="pln">m</span><span class="pun">.</span><span class="pln">n_rows</span><span class="pun">);</span><span class="pln">

    </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">power</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">power </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
            result </span><span class="pun">=</span><span class="pln"> result </span><span class="pun">*</span><span class="pln"> m</span><span class="pun">;</span><span class="pln">
        m </span><span class="pun">=</span><span class="pln"> m </span><span class="pun">*</span><span class="pln"> m</span><span class="pun">;</span><span class="pln">
        power </span><span class="pun">&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">return</span><span class="pln"> result</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span></code></pre>
<p>Remember, this implementation is only meant for <strong>learning</strong> purposes. You may come up with better (faster, more readable, more C++-ish) approach.</p>
<p>There are two tricks I want to mention, that speed up usual computations:</p>
<ol>
<li>If the modulo MOD in problem is such, that MOD<sup>2</sup> fits into long long, then you can <strong>reduce number of modulo operations to O(n<sup>2</sup>)</strong> (in case of multiplying two n x n matrices A and B).</li>
<li>If you problem requires answering many queries of raising the same matrix M to some power, you can precalculate powers of two of M to get things done faster. My solution for Candy Distribution 3 using this trick (and some others): </li>
</ol>
<p>&nbsp;</p>
<pre class="prettyprint prettyprinted"><code><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> MOD </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1e9</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> </span><span class="lit">7</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> MOD2 </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">static_cast</span><span class="pun">&lt;</span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pun">&gt;(</span><span class="pln">MOD</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> MOD</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">const</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> MAX_K </span><span class="pun">=</span><span class="pln"> </span><span class="lit">50</span><span class="pun">;</span><span class="pln">

</span><span class="kwd">struct</span><span class="pln"> </span><span class="typ">Matrix</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    vector</span><span class="pun">&lt;</span><span class="pln"> vector</span><span class="str">&lt;int&gt;</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> mat</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> n_rows</span><span class="pun">,</span><span class="pln"> n_cols</span><span class="pun">;</span><span class="pln">

    </span><span class="typ">Matrix</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">

    </span><span class="typ">Matrix</span><span class="pun">(</span><span class="pln">vector</span><span class="pun">&lt;</span><span class="pln"> vector</span><span class="str">&lt;int&gt;</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> values</span><span class="pun">):</span><span class="pln"> mat</span><span class="pun">(</span><span class="pln">values</span><span class="pun">),</span><span class="pln"> n_rows</span><span class="pun">(</span><span class="pln">values</span><span class="pun">.</span><span class="pln">size</span><span class="pun">()),</span><span class="pln">
        n_cols</span><span class="pun">(</span><span class="pln">values</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">size</span><span class="pun">())</span><span class="pln"> </span><span class="pun">{}</span><span class="pln">

    </span><span class="kwd">static</span><span class="pln"> </span><span class="typ">Matrix</span><span class="pln"> identity_matrix</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> n</span><span class="pun">)</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        vector</span><span class="pun">&lt;</span><span class="pln"> vector</span><span class="str">&lt;int&gt;</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> values</span><span class="pun">(</span><span class="pln">n</span><span class="pun">,</span><span class="pln"> vector</span><span class="str">&lt;int&gt;</span><span class="pun">(</span><span class="pln">n</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">));</span><span class="pln">
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
            values</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> values</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="typ">Matrix</span><span class="pln"> </span><span class="kwd">operator</span><span class="pun">*(</span><span class="kwd">const</span><span class="pln"> </span><span class="typ">Matrix</span><span class="pln"> </span><span class="pun">&amp;</span><span class="pln">other</span><span class="pun">)</span><span class="pln"> </span><span class="kwd">const</span><span class="pln"> 
    </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> n </span><span class="pun">=</span><span class="pln"> n_rows</span><span class="pun">,</span><span class="pln"> m </span><span class="pun">=</span><span class="pln"> other</span><span class="pun">.</span><span class="pln">n_cols</span><span class="pun">;</span><span class="pln">
        vector</span><span class="pun">&lt;</span><span class="pln"> vector</span><span class="str">&lt;int&gt;</span><span class="pln"> </span><span class="pun">&gt;</span><span class="pln"> result</span><span class="pun">(</span><span class="pln">n_rows</span><span class="pun">,</span><span class="pln"> vector</span><span class="str">&lt;int&gt;</span><span class="pun">(</span><span class="pln">n_cols</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">));</span><span class="pln">
        </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
            </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;</span><span class="pln"> m</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> tmp </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
                </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> k </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> k </span><span class="pun">&lt;</span><span class="pln"> n_cols</span><span class="pun">;</span><span class="pln"> k</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
                    tmp </span><span class="pun">+=</span><span class="pln"> mat</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">k</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">1ll</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> other</span><span class="pun">.</span><span class="pln">mat</span><span class="pun">[</span><span class="pln">k</span><span class="pun">][</span><span class="pln">j</span><span class="pun">];</span><span class="pln">
                    </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">tmp </span><span class="pun">&gt;=</span><span class="pln"> MOD2</span><span class="pun">)</span><span class="pln">
                        tmp </span><span class="pun">-=</span><span class="pln"> MOD2</span><span class="pun">;</span><span class="pln">
                </span><span class="pun">}</span><span class="pln">
                result</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> tmp </span><span class="pun">%</span><span class="pln"> MOD</span><span class="pun">;</span><span class="pln">
            </span><span class="pun">}</span><span class="pln">

        </span><span class="kwd">return</span><span class="pln"> move</span><span class="pun">(</span><span class="typ">Matrix</span><span class="pun">(</span><span class="pln">move</span><span class="pun">(</span><span class="pln">result</span><span class="pun">)));</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">

    </span><span class="kwd">inline</span><span class="pln"> </span><span class="kwd">bool</span><span class="pln"> is_square</span><span class="pun">()</span><span class="pln"> </span><span class="kwd">const</span><span class="pln">
    </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">return</span><span class="pln"> n_rows </span><span class="pun">==</span><span class="pln"> n_cols</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">};</span><span class="pln">

</span><span class="com">// M_powers[i] is M, raised to 2^i-th power</span><span class="pln">
</span><span class="typ">Matrix</span><span class="pln"> M_powers</span><span class="pun">[</span><span class="lit">55</span><span class="pun">];</span><span class="pln">

</span><span class="kwd">void</span><span class="pln"> precalc_powers</span><span class="pun">(</span><span class="typ">Matrix</span><span class="pln"> M</span><span class="pun">)</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">assert</span><span class="pun">(</span><span class="pln">M</span><span class="pun">.</span><span class="pln">is_square</span><span class="pun">());</span><span class="pln">
    M_powers</span><span class="pun">[</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> M</span><span class="pun">;</span><span class="pln">

    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> </span><span class="lit">55</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
        M_powers</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> M_powers</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> M_powers</span><span class="pun">[</span><span class="pln">i </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">];</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="typ">Matrix</span><span class="pln"> fast_exponentiation_with_precalc</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> power</span><span class="pun">)</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    </span><span class="typ">Matrix</span><span class="pln"> result </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Matrix</span><span class="pun">::</span><span class="pln">identity_matrix</span><span class="pun">(</span><span class="pln">M_powers</span><span class="pun">[</span><span class="lit">0</span><span class="pun">].</span><span class="pln">mat</span><span class="pun">.</span><span class="pln">size</span><span class="pun">());</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> pointer </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">power</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">if</span><span class="pun">(</span><span class="pln">power </span><span class="pun">&amp;</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)</span><span class="pln">
            result </span><span class="pun">=</span><span class="pln"> result </span><span class="pun">*</span><span class="pln"> M_powers</span><span class="pun">[</span><span class="pln">pointer</span><span class="pun">];</span><span class="pln">
        pointer</span><span class="pun">++;</span><span class="pln">
        power </span><span class="pun">&gt;&gt;=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> result</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">inline</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> get_int</span><span class="pun">()</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">char</span><span class="pln"> c</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> ret </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">isdigit</span><span class="pun">(</span><span class="pln">c </span><span class="pun">=</span><span class="pln"> getchar</span><span class="pun">()))</span><span class="pln">
        ret </span><span class="pun">=</span><span class="pln"> ret </span><span class="pun">*</span><span class="pln"> </span><span class="lit">10</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> c </span><span class="pun">-</span><span class="pln"> </span><span class="str">'0'</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">return</span><span class="pln"> ret</span><span class="pun">;</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="kwd">int</span><span class="pln"> main</span><span class="pun">()</span><span class="pln">
</span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">int</span><span class="pln"> t</span><span class="pun">;</span><span class="pln">
    </span><span class="typ">Matrix</span><span class="pln"> M</span><span class="pun">({</span><span class="pln"> 
            </span><span class="pun">{</span><span class="lit">4</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">},</span><span class="pln"> 
            </span><span class="pun">{</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">},</span><span class="pln"> 
            </span><span class="pun">{</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">}</span><span class="pln"> </span><span class="pun">});</span><span class="pln">
    precalc_powers</span><span class="pun">(</span><span class="pln">M</span><span class="pun">);</span><span class="pln">

    </span><span class="typ">Matrix</span><span class="pln"> initial</span><span class="pun">({</span><span class="pln"> </span><span class="pun">{</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">}</span><span class="pln"> </span><span class="pun">});</span><span class="pln">
    t </span><span class="pun">=</span><span class="pln"> get_int</span><span class="pun">();</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> t</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
        </span><span class="kwd">int</span><span class="pln"> n </span><span class="pun">=</span><span class="pln"> get_int</span><span class="pun">();</span><span class="pln">
        cout </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="pun">(</span><span class="pln">initial </span><span class="pun">*</span><span class="pln"> fast_exponentiation_with_precalc</span><span class="pun">(</span><span class="pln">n </span><span class="pun">-</span><span class="pln"> </span><span class="lit">1</span><span class="pun">)).</span><span class="pln">mat</span><span class="pun">[</span><span class="lit">0</span><span class="pun">][</span><span class="lit">0</span><span class="pun">]</span><span class="pln"> </span><span class="pun">&lt;&lt;</span><span class="pln"> </span><span class="str">"\n"</span><span class="pun">;</span><span class="pln">
    </span><span class="pun">}</span><span class="pln">
</span><span class="pun">}</span><span class="pln">

</span><span class="pun">(</span><span class="pln">however</span><span class="pun">,</span><span class="pln"> it can </span><span class="kwd">not</span><span class="pln"> </span><span class="kwd">pass</span><span class="pln"> all tests</span><span class="pun">,</span><span class="pln"> because the intended solution </span><span class="kwd">is</span><span class="pln"> pure precalculation</span><span class="pun">).</span></code></pre>
<p>The modulo trick alone:  </p>
<pre class="prettyprint prettyprinted"><code><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> MOD2 </span><span class="pun">=</span><span class="pln"> MOD </span><span class="pun">*</span><span class="pln"> MOD</span><span class="pun">;</span><span class="pln">
</span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln">
  </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> j </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> j</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
    </span><span class="kwd">long</span><span class="pln"> </span><span class="kwd">long</span><span class="pln"> tmp </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln">
    </span><span class="kwd">for</span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> k </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> k </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> k</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span><span class="pln">
      </span><span class="com">// Since A and B are taken modulo MOD, the product A[i][k] * B[k][j] is</span><span class="pln">
      </span><span class="com">// not more than MOD * MOD.</span><span class="pln">
      tmp </span><span class="pun">+=</span><span class="pln"> A</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">k</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">1ll</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> B</span><span class="pun">[</span><span class="pln">k</span><span class="pun">][</span><span class="pln">j</span><span class="pun">];</span><span class="pln">
      </span><span class="kwd">while</span><span class="pun">(</span><span class="pln">tmp </span><span class="pun">&gt;=</span><span class="pln"> MOD2</span><span class="pun">)</span><span class="pln"> </span><span class="com">// Taking modulo MOD2 is easy, because we can do it by subtraction</span><span class="pln">
       tmp </span><span class="pun">-=</span><span class="pln"> MOD2</span><span class="pun">;</span><span class="pln">
      </span><span class="pun">}</span><span class="pln">
    result</span><span class="pun">[</span><span class="pln">i</span><span class="pun">][</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> tmp </span><span class="pun">%</span><span class="pln"> MOD</span><span class="pun">;</span><span class="pln"> </span><span class="com">// One % operation per resulting element</span><span class="pln">
  </span><span class="pun">}</span></code></pre>
<p>In general, solutions using matrix multiplication are very short. The longest code I’ve written was 201 lines, and it was really tedious problem.</p>
<h2>Practice problems</h2>
<p>There are many beautiful problems on HackerEarth, that benefit from matrix exponentiation. My first encounter with this technique started with the problem “Tiles” from December Clash.</p>
<p>Most problems here require a dynamic programming solution, which is later improved by fast exponentiation.</p>
<ol>
<li><a href="https://www.hackerearth.com/problem/algorithm/pk-and-interesting-language/description/">PK and interesting language</a><br>
    Difficulty: easy<br>
    Comment: problem is explained in this article, so you should be able to implement it right away.</li>
<li><a href="https://www.hackerearth.com/problem/algorithm/tiles/">Tiles</a><br>
    Difficulty: medium-hard<br>
    Prerequisites: bitmask dynamic programming<br>
    Comment: surprisingly, this problem does not have tag “Matrix exponentiation”.</li>
<li><a href="https://www.hackerearth.com/problem/algorithm/abcd-strings/description/">ABCD strings</a><br>
    Difficulty: medium-hard<br>
    Comment: harder version of “PK and interesting language”. Here you have to come up with the matrix yourself. Mine was of size 16.  </li>
<li><a href="https://www.hackerearth.com/problem/algorithm/mehta-and-the-difficult-task-3/">Mehta and the difficult task</a>, <a href="https://www.hackerearth.com/problem/algorithm/mehta-and-the-evil-strings/">Mehta and the evil strings</a><br>
    Difficulty: medium<br>
    Prerequisites: basics of bitmasking<br>
    Comment: two similar problems from the same author. Once you solve either of them, the other one should be easy.</li>
<li><a href="https://www.hackerearth.com/problem/algorithm/long-walks-from-office-to-home-sweet-home-1/">Long walks from office to home sweet home</a><br>
    Difficulty: easy-medium<br>
    Comment: somewhat similar to “PK and interesting language”. </li>
</ol>
    </div> <!-- end note-body -->

    
    <div class="social-share medium-margin content">
        <!-- fb, twitter, g+ buttons -->
        <!-- the urls are messed up because they were changed post launch -->
        <div class="fb-like float-left medium-margin-right fb_iframe_widget" data-href="https://www.hackerearth.com/practice/notes/matrix-exponentiation-1/" data-send="false" data-layout="button_count" data-width="100" data-show-faces="false" data-font="lucida grande" fb-xfbml-state="rendered" fb-iframe-plugin-query="app_id=&amp;container_width=0&amp;font=lucida%20grande&amp;href=https%3A%2F%2Fwww.hackerearth.com%2Fpractice%2Fnotes%2Fmatrix-exponentiation-1%2F&amp;layout=button_count&amp;locale=en_US&amp;sdk=joey&amp;send=false&amp;show_faces=false&amp;width=100"><span style="vertical-align: bottom; width: 61px; height: 20px;"><iframe name="f250e0973e7ff5c" width="100px" height="1000px" frameborder="0" allowtransparency="true" allowfullscreen="true" scrolling="no" title="fb:like Facebook Social Plugin" src="./Matrix exponentiation _ HackerEarth_files/like.html" style="border: none; visibility: visible; width: 61px; height: 20px;" class=""></iframe></span></div>
        <div class="float-left medium-margin-right"><iframe id="twitter-widget-0" scrolling="no" frameborder="0" allowtransparency="true" class="twitter-share-button twitter-share-button-rendered twitter-tweet-button" title="Twitter Tweet Button" src="./Matrix exponentiation _ HackerEarth_files/tweet_button.9384f3649360e38a7002082a80b92414.en.html" style="position: static; visibility: visible; width: 60px; height: 20px;" data-url="https://www.hackerearth.com/practice/notes/matrix-exponentiation-1/"></iframe></div>
        <div class="float-left"><div id="___plusone_0" style="text-indent: 0px; margin: 0px; padding: 0px; background: transparent; border-style: none; float: none; line-height: normal; font-size: 1px; vertical-align: baseline; display: inline-block; width: 32px; height: 20px;"><iframe ng-non-bindable="" frameborder="0" hspace="0" marginheight="0" marginwidth="0" scrolling="no" style="position: static; top: 0px; width: 32px; margin: 0px; border-style: none; left: 0px; visibility: visible; height: 20px;" tabindex="0" vspace="0" width="100%" id="I0_1502829247101" name="I0_1502829247101" src="./Matrix exponentiation _ HackerEarth_files/fastbutton.html" data-gapiattached="true" title="G+"></iframe></div></div>
        <!-- end of social buttons -->
        <div class="clear"></div>
    </div> <!-- social-share -->
    

    
    <div id="comments-320-629" class="pagelet-inview comments standard-margin" ajax="/comment-action/load-comments/629/320/with-voting/with-sort/" target="comments-320-629"></div>
    
</div> <!-- end notes-container -->

        </div><!-- left -->

        <div class="right medium-margin">
            <div class="right-box">
                <div class="title"><i class="fa fa-magic less-margin-bottom"></i> Author</div>
                <hr class="hr-dashed">
                        
                <div class="content">
                    <div class="notes-user-info ">
                        <a href="https://www.hackerearth.com/@misha" class="profile-pic inline-block medium-margin-right v-align-top">
                            <img src="./Matrix exponentiation _ HackerEarth_files/0e47b5cimg_20140706_164324.jpg" alt="misha" width="80" height="80" onerror="if(typeof handle_avatar_error==&#39;function&#39;){handle_avatar_error(this);}">
                        </a>
                        <div class="inline-block user-info light small">
                            <a href="https://www.hackerearth.com/@misha" class="inline-block large dark weight-600 hover-link">Mike Koltsov</a>
                            
                            
                            <div><i class="fa fa-map-marker small"></i> Saint Petersburg, Russia</div>
                            
                            <div><a href="https://www.hackerearth.com/practice/notes/u/misha/" class="light weight-600"><i class="fa fa-file-text-o small"></i> 3 notes</a></div>
                        </div> <!-- user-info -->
                    </div> <!-- notes-user-info -->
                </div> <!-- content -->
            </div> <!-- right-box -->

            <div class="right-box" id="142c9af"><div class="title">Trending Notes</div>
<hr class="hr-dashed">
<div class="content">
    
    <div class="less-margin-2">
        <a href="https://www.hackerearth.com/practice/notes/divyanshu12/python-diaries-chapter-3/"> Python Diaries Chapter 3 Map | Filter |  For-else | List Comprehension</a>
        <div class="small">written by Divyanshu Bansal</div>
    </div>
    
    <div class="less-margin-2">
        <a href="https://www.hackerearth.com/practice/notes/askpk123/bokeh-interactive-visualization-library-use-graph-with-django-template/"> Bokeh | Interactive Visualization Library | Use Graph with Django Template</a>
        <div class="small">written by Prateek Kumar</div>
    </div>
    
    <div class="less-margin-2">
        <a href="https://www.hackerearth.com/practice/notes/askpk123/bokeh-interactive-visualization-library-graph-plotting/"> Bokeh | Interactive Visualization Library | Graph Plotting</a>
        <div class="small">written by Prateek Kumar</div>
    </div>
    
    <div class="less-margin-2">
        <a href="https://www.hackerearth.com/practice/notes/divyanshu12/python-diaries-chapter-2/"> Python Diaries chapter 2</a>
        <div class="small">written by Divyanshu Bansal</div>
    </div>
    
    <div class="less-margin-2">
        <a href="https://www.hackerearth.com/practice/notes/divyanshu12/python-diaries-chapter-1/">  Python Diaries chapter 1</a>
        <div class="small">written by Divyanshu Bansal</div>
    </div>
    
    <a href="https://www.hackerearth.com/practice/notes/" class="small float-right">more ... </a>
    <div class="clear"></div>
</div> <!-- content -->
</div>

        </div> <!-- right -->
        <div class="clear"></div>

    </div> <!-- responsive-container -->
</div> <!-- responsive-page -->


    <!-- include modal window for login/signup -->
    
        

<div id="login-modal" class="modal-window smaller-modal hidden">
    <div class="modal-header">
        <div class="login-form align-center larger">Log in</div>
        <div class="signup-form-div hidden align-center larger">Sign Up</div>
        <div class="password-reset hidden align-center larger">Reset Password</div>
    </div>
    <div class="modal-content">

        <div class="login-form">
            
                


<div class="modal-social-login align-center">
    
    
    <a url="/facebook/login/?display=popup&amp;next=%2Fsocial-login-complete%2F%3Forigin_protocol%3Dhttps%26origin_host%3Dwww.hackerearth.com%26redirect%3D/practice/notes/matrix-exponentiation-1/&amp;update=facebook&amp;source=practice" title="Facebook" class="button btn-facebook btn-medium show-popup inline-block margin-top-8 less-margin-right" minimal="true">
    
    <i class="fa fa-facebook"></i> <span class="regular weight-600 less-margin-left">Log in with Facebook</span>
    </a>
    
    <a url="/google/login/?next=%2Fsocial-login-complete%2F%3Forigin_protocol%3Dhttps%26origin_host%3Dwww.hackerearth.com%26redirect%3D/practice/notes/matrix-exponentiation-1/&amp;update=google&amp;source=practice" title="Google" class="button btn-google btn-medium show-popup inline-block margin-top-8 less-margin-right" minimal="true">
    
    <i class="fa fa-google-plus"></i> <span class="regular weight-600 less-margin-left">Log in with Google</span>
    </a>
    
    <div class="clear"></div>
</div>
<div class="align-center standard-margin word-with-line-head">
    <div class="word-with-line inline-block">
        <span class="large light">or</span>
    </div>
</div>

            
            <form id="modal-login-form" name="login-form" method="POST" class="ajax-form medium-margin" ajax="/AJAX/login/">
                




    

        

        
        <div class="wrapper small-wrapper">
            
            <input id="id_login" name="login" placeholder="Username or Email" type="text" required="">
        </div>
        <div class="wrapper small-wrapper">
            <input id="id_password" name="password" placeholder="Password" type="password" required="">
        </div>
        
    
    <input type="hidden" name="next" value="/practice/notes/matrix-exponentiation-1/">
     <div>
         <a href="https://www.hackerearth.com/practice/notes/matrix-exponentiation-1/#" class="link-3 show-hide-many float-right" show="password-reset" hide="login-form">Forgot Password?</a>
        <div class="clear"></div>
    </div>
    <div class="align-center medium-margin">
        <input type="submit" name="submit" clicked="Logging In.." value="Log in " class="button btn-orange fontawesome btn-largest weight-600 large">
    </div>

    <script type="text/javascript">
        try{
            grecaptcha.render('nocaptcha-recaptcha', {
                'sitekey' : ''
            });
        }
        catch(err){}

    </script>



            </form>
            
            <div class="align-center dark regular standard-margin dont-have-account">
                Don't have an account? <a href="https://www.hackerearth.com/practice/notes/matrix-exponentiation-1/#" class="link-13 show-hide-many regular" show="signup-form-div" hide="login-form"> Sign up</a>
            </div>
            
        </div>

        <div class="signup-form-div hidden">
            
                


<div class="modal-social-signup align-center">
    
    
    <a url="/facebook/login/?display=popup&amp;next=%2Fsocial-login-complete%2F%3Forigin_protocol%3Dhttps%26origin_host%3Dwww.hackerearth.com%26redirect%3D/practice/notes/matrix-exponentiation-1/&amp;update=facebook&amp;source=practice" title="Facebook" class="button btn-facebook btn-medium show-popup inline-block margin-top-8 less-margin-right" minimal="true">
    
    <i class="fa fa-facebook"></i> <span class="regular weight-600 less-margin-left">Join with Facebook</span>
    </a>
    
    <a url="/google/login/?next=%2Fsocial-login-complete%2F%3Forigin_protocol%3Dhttps%26origin_host%3Dwww.hackerearth.com%26redirect%3D/practice/notes/matrix-exponentiation-1/&amp;update=google&amp;source=practice" title="Google" class="button btn-google btn-medium inline-block margin-top-8 less-margin-right show-popup" minimal="true">
    
    <i class="fa fa-google-plus"></i> <span class="regular weight-600 less-margin-left">Join with Google</span>
    </a>
    
    <div class="clear"></div>
</div>
<div class="align-center standard-margin word-with-line-head">
    <div class="word-with-line inline-block">
        <span class="large light">or</span>
    </div>
</div>

            
            
            <form id="modal-signup-form" name="signup-form" method="POST" class="ajax-form medium-margin" ajax="/AJAX/hackerearth/signup/?source=practice&amp;next=/practice/notes/matrix-exponentiation-1/">
            
                


    
        

        
        <div class="wrapper small-wrapper float-left">
            <input id="id_first_name" maxlength="30" name="first_name" placeholder="First Name" type="text" required="" title="overall type: NAME_FIRST
    server type: NAME_FIRST
    heuristic type: NAME_FIRST
    label: First Name
    parseable name: first_name
    field signature: 1938669551
    form signature: 18206704445644016454" autofill-prediction="NAME_FIRST">
        </div>

        <div class="wrapper small-wrapper float-right">
            <input id="id_last_name" maxlength="30" name="last_name" placeholder="Last Name" type="text" title="overall type: NAME_LAST
    server type: NAME_LAST
    heuristic type: NAME_LAST
    label: Last Name
    parseable name: last_name
    field signature: 3389759488
    form signature: 18206704445644016454" autofill-prediction="NAME_LAST">
        </div>

        <div class="clear"></div>

        <div class="wrapper small-wrapper">
            <input id="id_email" maxlength="75" name="email" placeholder="Email" type="text" required="" title="overall type: EMAIL_ADDRESS
    server type: EMAIL_ADDRESS
    heuristic type: EMAIL_ADDRESS
    label: Email
    parseable name: email
    field signature: 420638584
    form signature: 18206704445644016454" autofill-prediction="EMAIL_ADDRESS">
        </div>
        <div class="wrapper small-wrapper">
            <input id="id_password" name="password" placeholder="Password" type="password" required="" title="overall type: ACCOUNT_CREATION_PASSWORD
    server type: ACCOUNT_CREATION_PASSWORD
    heuristic type: UNKNOWN_TYPE
    label: Password
    parseable name: password
    field signature: 2051817934
    form signature: 18206704445644016454" autofill-prediction="ACCOUNT_CREATION_PASSWORD" aria-autocomplete="list">
        </div>
    

    <div class="align-center medium-margin">
        <input type="submit" name="submit" clicked="Starting..." value="Start Now" class="button btn-blue fontawesome btn-largest weight-600 large">
        <div class="light smaller less-margin-2 t-and-c">
            By starting, you agree to HackerEarth's <a class="light" href="https://www.hackerearth.com/terms-of-service/" target="_blank">Terms of Service</a> and <a class="light" href="https://www.hackerearth.com/privacy/" target="_blank">Privacy Policy</a>.
        </div>
    </div>


            </form>
            <div class="align-center dark regular standard-margin dont-have-account">
                Have an account? <a href="https://www.hackerearth.com/practice/notes/matrix-exponentiation-1/#" class="link-13 show-hide-many regular" show="login-form" hide="signup-form-div"> Log in</a>
            </div>
        </div>

        <div class="password-reset hidden">
            <form name="password-reset" method="POST" class="ajax-form" ajax="/AJAX/password/reset/?next=/practice/notes/matrix-exponentiation-1/">
                




    
    <p class="dark large"> A password reset link will be sent to the following email id</p>
    
    <div class="wrapper">
        
        <input id="id_email" name="email" placeholder="Email" size="30" type="text" required="">
    </div>
    
    <div class="align-center medium-margin">
        <input type="submit" name="submit" clicked="Sending.." value="Send Password Reset Link" class="button btn-orange btn-largest weight-600 large">
    </div>


            </form>
        </div>
    </div>
</div>

    

    <!-- override this block where we do not want the footer -->
    
    
        
                





<div class="footer-large">
    <div class="content align-center">
        <div class="footer-sub-container">
            <div class="section">
                <a class="footer-link" href="https://www.hackerearth.com/team/" target="_blank">About Us</a>
            </div>
            <div class="section">
                <a class="footer-link" href="https://www.hackerearth.com/sprint/" target="_blank">Innovation Management</a>
            </div>
            <div class="section">
                <a class="footer-link" href="https://www.hackerearth.com/recruit/" target="_blank">Talent Assessment</a>
            </div>
            <div class="section">
                <a class="footer-link" href="https://www.hackerearth.com/university/" target="_blank">University Program</a>
            </div>
            <div class="section">
                <a class="footer-link" href="https://www.hackerearth.com/docs/wiki/developers/solution-guide/" target="_blank">Developers Wiki</a>
            </div>
            <div class="section">
                <a class="footer-link" href="http://blog.hackerearth.com/" target="_blank">Blog</a>
            </div>
            <div class="section">
                <a class="footer-link" href="https://www.hackerearth.com/press/" target="_blank">Press</a>
            </div>
            <div class="section">
                <a class="footer-link" href="https://www.hackerearth.com/companies/hackerearth/jobs/" target="_blank">Careers</a>
            </div>
            <div class="section">
                <a class="footer-link" href="https://www.hackerearth.com/reach-us/" target="_blank">Reach Us</a>
            </div>
            
        </div>
    </div> <!-- content -->
    <div class="clear"></div>
    <div class="footer-bottom-container lighter small">
        <div class="footer-bottom">
            
            <img src="./Matrix exponentiation _ HackerEarth_files/HE_identity.png">
            
            <div class="float-right">
                <span><a href="https://www.hackerearth.com/terms-of-service/">Terms and Conditions</a></span>
                <span class="separator">|</span>
                <span><a href="https://www.hackerearth.com/privacy/">Privacy</a></span>
                <span class="separator">|</span>
                <span class="align-right float-right">© 2017 HackerEarth</span>
            </div>
        </div>
    </div><!-- footer-bottom-container -->
</div>

        
    
    

    <div class="expand-box" id="recruiter-box" style="display: none;">
        <div class="down-arrow"></div>
        <ul class="no-margin">
            
            
            
            <a href="https://www.hackerearth.com/logout/?next=/practice/notes/matrix-exponentiation-1/"><li>Logout</li></a>
        </ul>
    </div>

    

    <!-- Include notifications box -->
    



<div class="expand-box" id="notifications-box" style="display: none;">
    <div class="down-arrow"></div>
    <div class="notifications-title-container">
        <div class="float-left weight-600">Notifications</div>
        <div class="float-right">
            <a href="https://www.hackerearth.com/practice/notes/matrix-exponentiation-1/#" ajax="https://www.hackerearth.com/notifications/AJAX/mark-all-read/" class="notif-mark-all-read link smaller clicky-ajax">Mark All as Read</a>
        </div>
        <div class="clear"></div>
    </div> <!-- notifications-title-container -->

    <div class="notifications-container nice-scrollbar" id="notifications-container" tabindex="5000" style="overflow: hidden; outline: none;">
    </div> <!-- notifications-container -->

    <div class="smaller caps weight-600 align-center less-margin-2 less-margin-2-bottom">
        <a class="link" href="https://www.hackerearth.com/notifications/">View All Notifications</a>
    </div>
<div id="ascrail2000" class="nicescroll-rails" style="width: 7px; z-index: 10; background: rgb(238, 238, 238); cursor: default; position: absolute; top: 1px; left: -7px; height: 0px; opacity: 1; display: none;"><div style="position: relative; top: 0px; float: right; width: 7px; height: 0px; background-color: rgb(204, 204, 204); border: none; background-clip: padding-box; border-radius: 0px;"></div></div><div id="ascrail2000-hr" class="nicescroll-rails" style="height: 7px; z-index: 10; background: rgb(238, 238, 238); top: -6px; left: 0px; position: absolute; opacity: 1; cursor: default; display: none;"><div style="position: relative; top: 0px; height: 7px; width: 0px; background-color: rgb(204, 204, 204); border: none; background-clip: padding-box; border-radius: 0px;"></div></div></div> <!-- notifications-box -->


    <!-- Load notification icon with unread count -->
    <div id="header-notif-icon-trigger" class="load-pagelet hidden" target="header-notif-icon" ajax="/notifications/pagelets/header-notif-icon-count/" show-loader="false"></div>

    
    <!-- Load live events widget -->
    <div id="live-events-trigger" class="load-pagelet hidden" target="live-events-trigger-data" ajax="/AJAX/live_events_widget_count/" show-loader="false"></div>
    

    

    

    

    
    

        
        

        <!-- Store any json returned for bigpipe -->
        <div id="bigpipe-json" class="hidden">
            {"142c9af": "/recommendation/pagelets/trending-card/?sensual=True"}
        </div>

        <!-- Store any json returned for bigpipe -->
        <div id="user-prompt-json" class="hidden">
            {}
        </div>

        <!-- Store any html returned for feedback popup -->
        <div id="user-feedback-popup" class="hidden"></div>


        <!-- realtime host -->
        <div id="realtime-host" class="hidden">realtime.hackerearth.com</div>
        <!-- realtime port -->
        <div id="realtime-port" class="hidden">80</div>

        <!-- client name for updating parts of page in realtime -->
        <div id="pusher-channel-name-0" class="hidden">5d698a2515f47966ae01e8faa8262d15a0c41b24</div>
        

        
            <div id="common-notification">
            </div>
        
        <!-- pusher app key -->
        <div id="pusher-app-key" class="hidden">58a29e5cae2309f04b28</div>

        <!-- pusher auth url -->
        <div id="pusher-auth-url" class="hidden">/realtime/pusher/auth/</div>

        <!-- ping url for user presence -->
        <div id="ghost-ping-url" class="hidden" ajax="https://ghost-kjio.hackerearth.com/ghost/ping/"></div>

        
        

        <!-- url to get active lab features -->
        
        <!-- All the scripts go here -->
        <script>
            var CURRENT_PATH = "https://www.hackerearth.com/practice/notes/matrix-exponentiation-1/";
            var HISTORY = '';

            // Make code constants available globally in JS
            var MAP_LANG_TO_NAME = {"SCALA_2118": "Scala 2.11.8", "LUA": "Lua", "PASCAL": "Pascal", "CSHARP": "C#", "CPP": "C++", "PYTHON3": "Python 3", "POSTGRESQL": "PostgreSQL", "KOTLIN": "Kotlin", "SCALA": "Scala", "PERL": "Perl", "HASKELL": "Haskell", "D": "D", "CPP14": "C++14", "R": "R(RScript)", "CPP11": "C++11", "GO": "Go", "RUBY": "Ruby", "GROOVY": "Groovy", "LOLCODE": "LOLCODE", "LISP": "Lisp", "Text": "Text", "WHENEVER": "Whenever", "MYSQL": "MySQL", "OBJECTIVEC": "Objective-C", "PHP": "PHP", "JAVASCRIPT_UI": "JavaScript", "PYTHON": "Python", "JAVASCRIPT": "JavaScript(Rhino)", "VB": "Visual Basic", "vp": "N/A", "TEXTFILE": "Text", "JAVA8": "Java 8", "JAVASCRIPT_NODE": "JavaScript(Node.js)", "RACKET": "Racket", "HTML": "HTML", "SWIFT": "Swift", "RUST": "Rust", "FSHARP": "F#", "C": "C", "OCAML": "OCaml", "OCTAVE": "Octave", "CLOJURE": "Clojure", "BEFUNGE": "Befunge", "CSS": "CSS", "ERLANG": "Erlang", "JAVA": "Java", "LISP_SBCL": "Lisp (SBCL)", "JULIA": "Julia", "ORACLE": "Oracle Database", "MSSQL": "MSSQL"};
            var MAP_NAME_TO_LANG = {"Lisp (SBCL)": "LISP_SBCL", "Java": "JAVA", "Scala": "SCALA", "JavaScript": "JAVASCRIPT_UI", "Perl": "PERL", "Lua": "LUA", "JavaScript(Rhino)": "JAVASCRIPT", "MySQL": "MYSQL", "Erlang": "ERLANG", "LOLCODE": "LOLCODE", "HTML": "HTML", "C#": "CSHARP", "Lisp": "LISP", "C++14": "CPP14", "Rust": "RUST", "Octave": "OCTAVE", "Ruby": "RUBY", "Scala 2.11.8": "SCALA_2118", "Groovy": "GROOVY", "C": "C", "Python 3": "PYTHON3", "Whenever": "WHENEVER", "Kotlin": "KOTLIN", "F#": "FSHARP", "N/A": "vp", "C++": "CPP", "Racket": "RACKET", "Objective-C": "OBJECTIVEC", "Swift": "SWIFT", "R(RScript)": "R", "D": "D", "Clojure": "CLOJURE", "Befunge": "BEFUNGE", "Java 8": "JAVA8", "CSS": "CSS", "PostgreSQL": "POSTGRESQL", "Text": "TEXTFILE", "OCaml": "OCAML", "Julia": "JULIA", "JavaScript(Node.js)": "JAVASCRIPT_NODE", "Python": "PYTHON", "Pascal": "PASCAL", "Haskell": "HASKELL", "C++11": "CPP11", "Go": "GO", "Visual Basic": "VB", "PHP": "PHP", "MSSQL": "MSSQL", "Oracle Database": "ORACLE"};
        </script>

        
        <!-- alljs: static_media/js/jquery-1.7.min.patched.js static_media/js/jquery.color.js static_media/js/jquery.elastic.js static_media/js/ajaxSend.js  static_media/js/jquery.inview.js  static_media/js/tooltip/jquery.tipTip.modified.js  static_media/offline/offline.min.js  static_media/js/watermark.min.js  static_media/history.js?v=0.1/scripts/bundled/html4html5/jquery.history.js  static_media/js/jquery.nicescroll.js  static_media/simplemodal/simplemodal.js static_media/js/jquery.sticky.js static_media/js/pusher.min.js static_media/js/ifvisible.min.js static_media/ghost/ghost.js static_media/feeds/feeds.js static_media/base/progress_bar.js -->
        


<script>
    UPLOADING_TEXT = "Uploading";
    UPLOADED_TEXT = "Uploaded";
    SAVING_TEXT = "Saving..";
    UPLOAD_SUCCESS_MESSAGE = "File saved successfully.";
    UPLOAD_ERROR_MESSAGE = "An error occured while saving, please try again in sometime.";
</script>
<script type="text/javascript" src="./Matrix exponentiation _ HackerEarth_files/alljs.js" crossorigin="anonymous"></script>

        <script type="text/javascript" src="./Matrix exponentiation _ HackerEarth_files/base1.0.1.js" crossorigin="anonymous"></script>
        <script type="text/javascript" src="./Matrix exponentiation _ HackerEarth_files/bigpipe.js" crossorigin="anonymous"></script>
        <script type="text/javascript" src="./Matrix exponentiation _ HackerEarth_files/pusher_realtime.js" crossorigin="anonymous"></script>
        <script type="text/javascript" src="./Matrix exponentiation _ HackerEarth_files/userprompt.js" crossorigin="anonymous"></script>
        <script type="text/javascript" src="./Matrix exponentiation _ HackerEarth_files/history.js" crossorigin="anonymous"></script>
        <script type="text/javascript" src="./Matrix exponentiation _ HackerEarth_files/commentUtils.js" crossorigin="anonymous"></script>

        
        <script src="./Matrix exponentiation _ HackerEarth_files/api.js" async="" defer=""></script>
        

        <script src="./Matrix exponentiation _ HackerEarth_files/offline.min.js" crossorigin="anonymous"></script>
        

        
        <script type="text/x-mathjax-config;executed=true">
          MathJax.Hub.Config({messageStyle: "none",
            tex2jax: {
              inlineMath: [['$$','$$']],
              displayMath: [['$$$', '$$$']],
              preview: "none"
            }
          });
        </script>
        <script type="text/javascript" async="" src="./Matrix exponentiation _ HackerEarth_files/MathJax.js"></script>
        <script type="text/javascript" src="./Matrix exponentiation _ HackerEarth_files/MathJax(1).js"></script>

        <script type="text/javascript">
          window.addEventListener("load", function() {
            MathJax.Hub.Queue(["Typeset", MathJax.Hub]);
          });
        </script>
        

        <script>
            Offline.options = {
                interceptRequests: false,
                requests: false,
            };
        </script>

        
        <script>
            // do all maps stuff here
            function initializeMaps(){

                // Call other map functions
                try{
                    window.mapStuff();
                } catch(err){
                }

            }

            function loadMaps() {
                var script = document.createElement('script');
                script.type = 'text/javascript';
                script.src = 'https://maps.googleapis.com/maps/api/js?sensor=false&libraries=places&callback=initializeMaps';
                document.body.appendChild(script);
            }

            $(document).ready(function(){
                loadMaps();
            });

        </script>
        

        


<script>

$(document).ready(function (){
    $('#header-notif-icon-trigger').click();

    
    $('#live-events-trigger').click();
    

    
    
    
    

    // show kone ge widget if not visited
    

});
</script>

<script type="text/javascript">
$(document).ready(function() {
    
    var m_links = {};
    var m_elements = {
        '#modal-login-form input[type=submit]': 'Modal Email Login',
        '#modal-signup-form input[type=submit]': 'Modal Email Signup',
        '.modal-social-login .btn-facebook': 'Modal Facebook Login',
        '.modal-social-login .btn-google': 'Modal Google Login',
        '.modal-social-signup .btn-facebook': 'Modal Facebook Signup',
        '.modal-social-signup .btn-google': 'Modal Google Signup',
        '.top-banner .login-banner a': 'Signup after banner click',
    };
    
    for (var key in m_elements) {
        $(key).live('click', {'key': key }, function(e) {
            var key = e.data.key;
            mixpanel.track('Click', {'name': m_elements[key]});
        });
    }
    for (var key in m_links) {
        mixpanel.track_links(key, 'Click', {'name': m_links[key]});
    }
});
</script>




<script type="text/javascript" src="./Matrix exponentiation _ HackerEarth_files/search.1.0.js" crossorigin="anonymous" async="" defer=""></script>





<script type="text/javascript" src="./Matrix exponentiation _ HackerEarth_files/lab.js" crossorigin="anonymous"></script>



        <script>
            // Used in search
            var is_user_logged_in = false;
        </script>

        <script type="text/javascript" src="./Matrix exponentiation _ HackerEarth_files/detect_timezone.js" crossorigin="anonymous"></script>
        <script>

            function setTimezoneCookie(detected_user_tz) {
                /* Sets the detected user timezone as a cookie in the browser.
                   If someone changes it or removes it, a sanity check is
                   performed and the cookie is reset.

                   This cookie is set for ready availability of user timezone
                   in the backend.
                */

                const USER_TIMEZONE_COOKIE = 'user_tz';
                // Try to get the existing user timezone cookie stored
                // in the browser.
                user_tz = readCookie(USER_TIMEZONE_COOKIE);

                // Flag to determine whether a new cookie has to be created.
                create_cookie = false;

                if(user_tz) {
                    if(user_tz !== detected_user_tz) {
                        // If someone has changed the cookie in some way, we
                        // set a new cookie.
                        eraseCookie(USER_TIMEZONE_COOKIE);
                        create_cookie = true;
                    }
                } else {
                    create_cookie = true;
                }

                // Create a new cookie if create_cookie flag is set.
                createCookie(USER_TIMEZONE_COOKIE, detected_user_tz, 1);

            }
            $(document).ready(function(){
                var timezone = jstz.determine_timezone(); // Now you have an instance of the TimeZone object.
                // Set as a cookie in browser for easy access in backend.
                setTimezoneCookie(timezone.name());

                // Set as a js variable for easy access across frontend.
                USER_TIMEZONE = timezone.name()

                
                
                
                

                

                
                    $.ajax({
                        type: "POST",
                        url:"/users/AJAX/set-timezone/",
                        data: {
                        'timezone': timezone.name(),
                        },
                    });
                
            });
        </script>

        

        <script type="text/javascript">
            
            $(document).ready(function(){
                //mixpanel delegate links custom method
                mixpanel.delegate_links = function (parent, selector, event_name, properties) {
                    properties = properties || {};
                    parent = parent || document.body;
                    parent = $(parent);
                    parent.on('click', selector, function (event) {
                        var new_tab = event.which === 2 || event.metaKey || event.target.target === '_blank' || this.target === '_blank';
                        properties.url = event.target.href || this.href;
                        function callback() {
                            if (new_tab) {
                                return;
                            }
                            window.location = properties.url;
                        }
                        if (!new_tab) {
                            event.preventDefault();
                            setTimeout(callback, 300);
                        }
                        mixpanel.track(event_name, properties, callback);
                    });
                };
            });
            
        </script>

        
<script type="text/javascript" src="./Matrix exponentiation _ HackerEarth_files/prettifyall.js" crossorigin="anonymous"></script>
<script type="text/javascript" src="./Matrix exponentiation _ HackerEarth_files/votes.js" crossorigin="anonymous"></script>
<script type="text/javascript" src="./Matrix exponentiation _ HackerEarth_files/tagging_autocomplete.js" crossorigin="anonymous"></script>

<script>
    $("#notes-title-bar").sticky({
        bottomSpacing: 600,
    });
    $("#notes-title-bar").width($("#notes-left-container").width()+ 'px');
</script>

<script>
$(document).ready(function() {
    styleCode();
});
</script>


        
        <!-- mixpanel analytics start -->
        <script type="text/javascript">(function(e,b){if(!b.__SV){var a,f,i,g;window.mixpanel=b;a=e.createElement("script");a.type="text/javascript";a.async=!0;a.src=("https:"===e.location.protocol?"https:":"http:")+'//cdn.mxpnl.com/libs/mixpanel-2.2.min.js';f=e.getElementsByTagName("script")[0];f.parentNode.insertBefore(a,f);b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.track_charge people.clear_charges people.delete_user".split(" ");for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,e,d])};b.__SV=1.2}})(document,window.mixpanel||[]);mixpanel.init("4c30b8635363027dfb780d5a61785112");</script>
        <!-- mixpanel analytics end -->
        <script type="text/javascript">
            
                
                    mixpanel.unregister("username");
                    mixpanel.unregister("email");
                    mixpanel.unregister("date_of_joining");
                    mixpanel.unregister("user_bucket");
                    mixpanel.unregister("company");
                    mixpanel.unregister("is_recruiter");
                    mixpanel.register({
                        "url_path": "/practice/notes/matrix-exponentiation-1/"
                    });
                
            
        </script>
        

        
        <div id="fb-root" class=" fb_reset"><div style="position: absolute; top: -10000px; height: 0px; width: 0px;"><div><iframe name="fb_xdm_frame_https" frameborder="0" allowtransparency="true" allowfullscreen="true" scrolling="no" id="fb_xdm_frame_https" aria-hidden="true" title="Facebook Cross Domain Communication Frame" tabindex="-1" src="./Matrix exponentiation _ HackerEarth_files/XBwzv5Yrm_1.html" style="border: none;"></iframe></div></div><div style="position: absolute; top: -10000px; height: 0px; width: 0px;"><div></div></div></div>
        <script>
            <!-- facebook button -->
            (function(d, s, id) {
                var js, fjs = d.getElementsByTagName(s)[0];
                if (d.getElementById(id)) return;
                js = d.createElement(s); js.id = id;
                js.src = "//connect.facebook.net/en_US/all.js#xfbml=1";
                fjs.parentNode.insertBefore(js, fjs);
            }(document, 'script', 'facebook-jssdk'));

            <!-- twitter button -->
            !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");

            <!-- google+ button -->
            (function() {
                var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
                po.src = 'https://apis.google.com/js/plusone.js';
                var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
            })();
        </script>
        

        
        <script>
        // Include the UserVoice JavaScript SDK (only needed once on a page)
        UserVoice=window.UserVoice||[];(function(){var uv=document.createElement('script');uv.type='text/javascript';uv.async=true;uv.src='//widget.uservoice.com/5F90ycbP4JOg1fOUoELScA.js';var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(uv,s)})();

        //
        // UserVoice Javascript SDK developer documentation:
        // https://www.uservoice.com/o/javascript-sdk
        //

        // Set colors
        UserVoice.push(['set', {
          accent_color: '#448dd6',
          trigger_color: 'white',
          trigger_background_color: 'rgba(46, 49, 51, 0.6)'
        }]);

        // Identify the user and pass traits
        // To enable, replace sample data with actual user traits and uncomment the line
        UserVoice.push(['identify', {
          //email:      'john.doe@example.com', // User’s email address
          //name:       'John Doe', // User’s real name
          //created_at: 1364406966, // Unix timestamp for the date the user signed up
          //id:         123, // Optional: Unique id of the user (if set, this should not change)
          //type:       'Owner', // Optional: segment your users by type
          //account: {
          //  id:           123, // Optional: associate multiple users with a single account
          //  name:         'Acme, Co.', // Account name
          //  created_at:   1364406966, // Unix timestamp for the date the account was created
          //  monthly_rate: 9.99, // Decimal; monthly rate of the account
          //  ltv:          1495.00, // Decimal; lifetime value of the account
          //  plan:         'Enhanced' // Plan name for the account
          //}
        }]);

        // Add default trigger to the bottom-right corner of the window:
        UserVoice.push(['addTrigger', { mode: 'contact', trigger_position: 'bottom-right' }]);

        // Or, use your own custom trigger:
        //UserVoice.push(['addTrigger', '#id', { mode: 'contact' }]);

        // Autoprompt for Satisfaction and SmartVote (only displayed under certain conditions)
        UserVoice.push(['autoprompt', {}]);
        </script>
        

    

</div>
<script type="text/javascript" id="">!function(b,e,f,g,a,c,d){b.fbq||(a=b.fbq=function(){a.callMethod?a.callMethod.apply(a,arguments):a.queue.push(arguments)},b._fbq||(b._fbq=a),a.push=a,a.loaded=!0,a.version="2.0",a.queue=[],c=e.createElement(f),c.async=!0,c.src=g,d=e.getElementsByTagName(f)[0],d.parentNode.insertBefore(c,d))}(window,document,"script","https://connect.facebook.net/en_US/fbevents.js");fbq("init","802574803157043",{em:"insert_email_variable,"});fbq("track","PageView");</script>
<noscript>&lt;img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=802574803157043&amp;amp;ev=PageView&amp;amp;noscript=1"&gt;</noscript>


<div id="tiptip_holder" style="max-width:200px;"><div id="tiptip_arrow"><div id="tiptip_arrow_inner"></div></div><div id="tiptip_content"></div></div><script type="text/javascript" src="./Matrix exponentiation _ HackerEarth_files/js"></script><div class="offline-ui offline-ui-up"><div class="offline-ui-content"></div></div><div class="offline-ui offline-ui-up"><div class="offline-ui-content"></div></div><div data-html2canvas-ignore="true" class="uv-icon uv-bottom-right"><svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="39px" height="39px" viewBox="0 0 39 39" enable-background="new 0 0 39 39" xml:space="preserve">
<g>
	<path class="uv-bubble-background" fill="rgba(46, 49, 51, 0.6)" d="M31.425,34.514c-0.432-0.944-0.579-2.007-0.591-2.999c4.264-3.133,7.008-7.969,7.008-13.409
		C37.842,8.658,29.594,1,19.421,1S1,8.658,1,18.105c0,9.446,7.932,16.79,18.105,16.79c1.845,0,3.94,0.057,5.62-0.412
		c0.979,1.023,2.243,2.3,2.915,2.791c3.785,2.759,7.571,0,7.571,0S32.687,37.274,31.425,34.514z" style="fill: rgba(46, 49, 51, 0.6);"></path>
	<g>
		<g>
			<path class="uv-bubble-foreground" fill="#FFFFFF" d="M16.943,19.467c0-3.557,4.432-3.978,4.432-6.058c0-0.935-0.723-1.721-2.383-1.721
				c-1.508,0-2.773,0.725-3.709,1.87l-2.441-2.743c1.598-1.9,4.01-2.924,6.602-2.924c3.891,0,6.271,1.959,6.271,4.765
				c0,4.4-5.037,4.732-5.037,7.265c0,0.481,0.243,0.994,0.574,1.266l-3.316,0.965C17.303,21.459,16.943,20.522,16.943,19.467z
				 M16.943,26.19c0-1.326,1.114-2.441,2.44-2.441c1.327,0,2.442,1.115,2.442,2.441c0,1.327-1.115,2.441-2.442,2.441
				C18.058,28.632,16.943,27.518,16.943,26.19z" style="fill: white;"></path>
		</g>
	</g>
</g>
</svg>
</div><iframe name="oauth2relay429260179" id="oauth2relay429260179" src="./Matrix exponentiation _ HackerEarth_files/postmessageRelay.html" tabindex="-1" aria-hidden="true" style="width: 1px; height: 1px; position: absolute; top: -100px;"></iframe></body></html>